(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4b39a3ed"],{"2cbc":function(e,t,a){"use strict";a("fd06")},"40a6":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_concat__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("2d38"),core_js_modules_es_array_concat__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_concat__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("2c78"),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_find__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("1b8a"),core_js_modules_es_array_find__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_find__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_flat__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("9c05"),core_js_modules_es_array_flat__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_flat__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("422c"),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_array_index_of__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("69bf"),core_js_modules_es_array_index_of__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_array_index_of__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("02bf"),core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_array_reduce__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("a39b"),core_js_modules_es_array_reduce__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_array_reduce__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("90d4"),core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_array_unscopables_flat__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("c627"),core_js_modules_es_array_unscopables_flat__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_array_unscopables_flat__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("5c4c"),core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_function_name__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es_number_constructor__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("4798"),core_js_modules_es_number_constructor__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es_number_constructor__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_number_to_fixed__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("4037"),core_js_modules_es_number_to_fixed__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_number_to_fixed__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("1f90"),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_13__),D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("4c09"),D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("d211"),vuedraggable__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("3335"),vuedraggable__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(vuedraggable__WEBPACK_IMPORTED_MODULE_16__),_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("b8f9"),_admin_mixin_model__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("4ec25"),_admin_components_EBranch__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("6b9c"),_admin_components_ListSelectModal__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("494e");__webpack_exports__["a"]={name:"PurchaseOrderModel",mixins:[_admin_mixin_model__WEBPACK_IMPORTED_MODULE_18__["a"]],data:function(){var e=this;return{active:1,cartesianList:[],currentProduct:[],formTemp:{data:[],oldData:[],productList:[]},formData:{money:0,isPay:3,payMoney:0,userId:this.$UserInfo.id,detail:[],productIds:[]},columns:[{title:this.$t("dt.form.Product"),oldTitle:this.$t("dt.form.Product"),align:"center",children:[{title:this.$t("dt.form.name"),key:"label",width:200,align:"center"},{title:this.$t("dt.form.Spec"),key:"name",width:200,align:"center",render:function(t,a){return t("span",a.row.name||e.$t("dt.base.Nothing"))}}]},{title:this.$t("dt.form.SkuPicture"),key:"skuPicture",width:100,align:"center",render:function(t,a){var r=t("Avatar",{props:{shape:"square",icon:"ios-images"}});return _common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(e.formTemp.data[a.index][a.column.key])||(r=t("Avatar",{props:{shape:"square",src:e.$options.filters.formatImage(e.formTemp.data[a.index][a.column.key])}})),r}},{title:this.$t("dt.form.PurchaseNumber"),key:"number",width:120,align:"center",renderHeader:function(t,a){var r=a.column;return e.isReadonly?t("span",r.title):t("div",[t("span",r.title),t("e-input",{props:{title:e.$t("dt.form.batch"),open:!0,isIntType:!0,columnKey:r.key},on:{handleDropdownInput:e.handleBatchAllMoney}})])},render:function(t,a){var r=a.row.number;return t("InputNumber",{props:{value:r,size:"small",min:1,clearable:!0,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.PurchaseNumber")})},on:{input:function(t){e.handleCheckMoney(t,e.formTemp.data[a.index],[a.column.key])}}},r)}},{title:this.$t("dt.form.PurchaseUnitPrice"),key:"unitPrice",width:120,align:"center",renderHeader:function(t,a){var r=a.column;return e.isReadonly?t("span",r.title):t("div",[t("span",r.title),t("e-input",{props:{title:e.$t("dt.form.batch"),open:!0,isIntType:!0,columnKey:r.key},on:{handleDropdownInput:e.handleBatchAllMoney}})])},render:function(t,a){var r=a.row.unitPrice;return t("Input",{props:{value:r,size:"small",clearable:!e.isReadonly,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.PurchaseUnitPrice")})},on:{input:function(t){e.handleCheckMoney(t,e.formTemp.data[a.index],[a.column.key])}}},r)}},{title:this.$t("dt.base.isTax"),key:"taxType",width:150,align:"center",renderHeader:function(t,a){var r=a.column;return e.isReadonly?t("span",r.title):t("div",[t("span",r.title),t("e-dropdown",{props:{open:!0,title:e.$t("dt.form.batch"),columnKey:r.key,name:"label",value:"value",dataList:e.$options.filters.taxType([])},on:{handleDropdownChange:function(t){_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(e.formTemp.data,(function(e){e[t.key]=t.data}))}}})])},render:function(t,a){return t("RadioGroup",{props:{value:a.row.taxType,size:"small"},on:{"on-change":function(t){e.handleCheckMoney(t,e.formTemp.data[a.index],[a.column.key])}}},[t("Radio",{props:{label:1,disabled:e.isReadonly}},e.$t("dt.base.NotTax")),t("Radio",{props:{label:2,disabled:e.isReadonly}},e.$t("dt.base.HasTax"))])}},{title:this.$t("dt.base.InTax"),key:"tax",width:120,align:"center",renderHeader:function(t,a){var r=a.column;return e.isReadonly?t("span",r.title):t("div",[t("span",r.title),t("e-input",{props:{title:e.$t("dt.form.batch"),open:!0,isIntType:!0,columnKey:r.key},on:{handleDropdownInput:e.handleBatchAllMoney}})])},render:function(t,a){var r=a.row.tax;return t("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},[t("InputNumber",{props:{value:r,size:"small",min:0,clearable:!0,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.base.InTax")})},on:{input:function(t){e.handleCheckMoney(t,e.formTemp.data[a.index],[a.column.key])}}}),t("span",{style:{marginLeft:"5px"}},"%")])}},{title:this.$t("dt.base.Discount"),key:"discount",width:120,align:"center",renderHeader:function(t,a){var r=a.column;return e.isReadonly?t("span",r.title):t("div",[t("span",r.title),t("e-input",{props:{title:e.$t("dt.form.batch"),open:!0,isIntType:!0,columnKey:r.key},on:{handleDropdownInput:e.handleBatchAllMoney}})])},render:function(t,a){var r=a.row.discount;return t("InputNumber",{props:{value:r,size:"small",max:10,min:1,step:.1,clearable:!0,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.base.Discount")})},on:{input:function(t){e.handleCheckMoney(t,e.formTemp.data[a.index],[a.column.key])}}},r)}},{title:this.$t("dt.base.PayablePrice"),align:"center",children:[{title:this.$t("dt.base.NotTax"),key:"payablePriceNotTax",width:120,align:"center",render:function(t,a){return t("span","".concat(a.row.payablePriceNotTax," ").concat(e.$t("dt.base.unit")))}},{title:this.$t("dt.base.HasTax"),key:"payablePrice",width:120,align:"center",render:function(t,a){return t("span","".concat(a.row.payablePrice," ").concat(e.$t("dt.base.unit")))}}]},{title:this.$t("dt.base.DiscountPrice"),align:"center",children:[{title:this.$t("dt.base.NotTax"),key:"discountPriceNotTax",width:120,align:"center",render:function(t,a){return t("span","".concat(a.row.discountPriceNotTax," ").concat(e.$t("dt.base.unit")))}},{title:this.$t("dt.base.HasTax"),key:"discountPrice",width:120,align:"center",render:function(t,a){return t("span","".concat(a.row.discountPrice," ").concat(e.$t("dt.base.unit")))}}]},{title:this.$t("dt.base.PaymentPrice"),align:"center",children:[{title:this.$t("dt.base.NotTax"),key:"paymentPriceNotTax",width:120,align:"center",render:function(t,a){return t("span","".concat(a.row.paymentPriceNotTax," ").concat(e.$t("dt.base.unit")))}},{title:this.$t("dt.base.HasTax"),key:"paymentPrice",width:120,align:"center",render:function(t,a){return t("span","".concat(a.row.paymentPrice," ").concat(e.$t("dt.base.unit")))}}]}],ruleInline:{name:[{required:!0,message:this.$t("dt.base.pleaseInput",{label:this.$t("dt.form.PurchaseOrderName")}),trigger:"blur"}],tyeId:[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.PurchaseOrderType")}),trigger:"blur"}],supplyId:[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.Supply")}),trigger:"blur"}],branchId:[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.ParentBranch")}),trigger:"blur"}],weight:[{required:!0,type:"number",message:this.$t("dt.form.weightPlaceholder"),trigger:"blur"},{validator:this.$Validator("number",this.$t("dt.form.weightPlaceholder")),trigger:"blur"}]}}},created:function(){_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(this.id)||this.handleDetail()},mounted:function(){},destroyed:function(){this.$apollo.getClient().cache.reset()},components:{draggable:vuedraggable__WEBPACK_IMPORTED_MODULE_16___default.a,EBranch:_admin_components_EBranch__WEBPACK_IMPORTED_MODULE_19__["a"],ListSelectModal:_admin_components_ListSelectModal__WEBPACK_IMPORTED_MODULE_20__["a"]},watch:{},methods:{handleDetail:function(){var e=this;this.$Http.Post({mutation:this.$Model.PurchaseOrderDetail,variables:{id:this.id},fields:["id","name","money","isPay","payMoney","status","startTime","endTime","branchId","remark","weight","state","productIds","detail.id","detail.skuId","detail.label","detail.name","detail.skuPicture","detail.number","detail.tax","detail.taxType","detail.unitPrice","detail.discount","detail.payablePrice","detail.payablePriceNotTax","detail.discountPrice","detail.discountPriceNotTax","detail.paymentPrice","detail.paymentPriceNotTax","tyeId","supplyId","userId"]},(function(){e.$router.push({name:"admin.PurchaseOrderList"})})).then((function(t){var a=t.data;a.state=1===a.state||!0===a.state,a.startTime&&(a.startTime=e.$options.filters.formatTime(a.startTime,"YYYY-MM-DD")),a.endTime&&(a.endTime=e.$options.filters.formatTime(a.endTime,"YYYY-MM-DD")),a.money=1*e.$options.filters.money(a.money),a.payMoney=1*e.$options.filters.money(a.payMoney),e.formTemp.data=a.detail||[],_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(e.formTemp.data,(function(t){t.unitPrice=e.$options.filters.money(t.unitPrice),t.payablePrice=e.$options.filters.money(t.payablePrice),t.payablePriceNotTax=e.$options.filters.money(t.payablePriceNotTax),t.discountPrice=e.$options.filters.money(t.discountPrice),t.discountPriceNotTax=e.$options.filters.money(t.discountPriceNotTax),t.paymentPrice=e.$options.filters.money(t.paymentPrice),t.paymentPriceNotTax=e.$options.filters.money(t.paymentPriceNotTax)})),e.handleProductValueList(a.productIds),e.formData=Object(D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_15__["a"])(Object(D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_15__["a"])({},e.formData),a)}))},handleProductValueList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.formData.productIds;this.$Http.Post({mutation:this.$Model.Products,variables:{perPage:0,filter:{id_in:t},sort:[{weight:"ASC"}]},fields:[{data:["id","name","weight","relationSku.id","relationSku.label"]}]}).then((function(t){var a=t.data;e.handleProductDataFunc(a.data,!1)}))},handleProductDataFunc:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.map((function(e){return e.id}));if(_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(this.formTemp.productList,(function(e){-1===r.indexOf(e.id)&&(e.data=[])})),_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(e))this.formTemp.data=[],this.formTemp.oldData=[],this.formTemp.productList=[],this.formTemp.cartesianList=[];else if(e.length<this.formData.productIds.length)this.formTemp.productList=this.formTemp.productList.filter((function(e){return-1!==r.indexOf(e.id)}));else{_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(this.formData.detail)||_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(e,(function(e){var a=e.relationSku.map((function(e){return e.id})),r=t.formData.detail.filter((function(e){return-1!==a.indexOf(e.skuId)})).map((function(e){return e.skuId}))||[];_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(r)||(e.data=r)}));var o=_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].sortBy(e,{key:"weight",type:"min"});_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(o,(function(e,r){var n=t.formTemp.productList.find((function(t){return t.id===e.id}));_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(n)?(e.indeterminate=!1,e.checkAll=!1,_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isArray(e.data)&&(!0===a?e.data=[]:e.data.forEach((function(t,a){_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(t)&&e.data.splice(a,1)})))):t.$set(o,r,Object(D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_15__["a"])({},n))})),this.formTemp.productList=o}this.handleCurrentProductChange()},handleProductGragChange:function(){this.handleCurrentProductChange()},handleCurrentProductChange:function(){var e=this;this.currentProduct=[],this.handleProductSkuChange();var t=this.formTemp.productList.filter((function(e){return e.data&&e.data.length>0}));_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(t)||_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(t,(function(t){var a=t.relationSku.filter((function(e){return-1!==t.data.indexOf(e.id)}));_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(a)||(_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(a,(function(e){e.name=t.name,e.productId=t.id})),e.currentProduct.push({label:t.name,value:a}))})),this.handleComposeSku()},handleComposeSku:function(){var e=this,t=[],a=this.currentProduct.map((function(e){return e.value})).flat();_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(a,(function(a){var r={label:a.name,name:a.label,productId:a.productId,skuId:a.id,skuPicture:a.skuPicture,number:1,unitPrice:null,discount:10,tax:0,taxType:1,payablePrice:0,payablePriceNotTax:0,discountPrice:0,discountPriceNotTax:0,paymentPrice:0,paymentPriceNotTax:0},o=e.formTemp.data.find((function(e){return e.skuId===a.id}));_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(o)||(r=o),t.push(r)})),this.isReadonly||(this.formTemp.data=t),this.formTemp.data.length>0?this.columns[0].title="".concat(this.columns[0].oldTitle,"(").concat(this.formTemp.data.length,")"):this.columns[0].title=this.columns[0].oldTitle},handleCartesianProduct:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return _common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isArray(e)&&e.length<2?Object(D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_14__["a"])(e[0].map((function(e){return[e]}))):e.reduce((function(e,t){var a=[];return e.forEach((function(e){t.forEach((function(t){var r=[].concat(Array.isArray(e)?e:[e]);r.push(t),a.push(r)}))})),a}))},handleCheckAll:function(e,t){var a=!e.checkAll,r=[],o=!1;!e.checkAll&&e.indeterminate?(a=!0,o=!1):e.indeterminate&&(a=!1),a&&(r=e.relationSku.map((function(e){return e.id}))),this.$set(this.formTemp.productList,t,Object(D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_15__["a"])(Object(D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_15__["a"])({},this.formTemp.productList[t]),{},{data:r,checkAll:a,indeterminate:o})),this.handleCurrentProductChange()},handleProductSkuChange:function(){_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(this.formTemp.productList,(function(e){e.data&&e.data.length===e.relationSku.length?(e.indeterminate=!1,e.checkAll=!0):e.data&&e.data.length>0?(e.indeterminate=!0,e.checkAll=!1):(e.indeterminate=!1,e.checkAll=!1)}))},handleSpan:function(e){var t=e.row,a=e.column,r=e.rowIndex;if(-1===this.currentProduct.map((function(e){return e.label})).indexOf(t[a.key]))return[1,1];var o=t[a.key];if(r>0&&o===this.formTemp.data[r-1][a.key])return[0,0];for(var n=[1,1],_=r+1;_<this.formTemp.data.length&&o===this.formTemp.data[_][a.key];_++)++n[0];return n},handleTableSummary:function(e){var t=this,a=e.columns,r=e.data,o={};return a.forEach((function(e,a){var n=e.key;if(0!==a)if(1!==a&&2!==a&&5!==a&&6!==a&&7!==a){var _=r.map((function(e){return Number(e[n])}));if(_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(_))o[n]={key:n,value:null};else{var i=_.reduce((function(e,t){return e+t}),0);3===a?o[n]={key:n,value:"".concat(i," ").concat(t.$t("dt.base.piece"))}:(o[n]={key:n,value:"".concat(t.$options.filters.formatMoney(i)," ").concat(t.$t("dt.base.unit"))},"paymentPrice"===n&&(t.formData.money=i,3===t.formData.isPay?t.formData.payMoney=i:1===t.formData.isPay&&(t.formData.payMoney=0)))}}else o[n]={key:n,value:null};else o[n]={key:n,value:t.$t("dt.base.Summary")}})),o},handleCheckMoney:function(e,t,a){if(!this.$rules.checkMoney(e))return this.$Message.error(this.$t("dt.toast.PleaseEnterTheCorrectAmount")),void(t[a]=null);t[a]=e;var r=t.unitPrice||0,o=t.number*r*Number((t.discount/10).toFixed(2));t.payablePrice=this.$options.filters.formatMoney(t.number*r),t.paymentPrice=this.$options.filters.formatMoney(o),1===t.taxType?(t.paymentPriceNotTax=t.paymentPrice,t.paymentPrice=this.$options.filters.formatMoney(1*t.paymentPriceNotTax*(1+t.tax/100)),t.payablePriceNotTax=t.payablePrice,t.payablePrice=this.$options.filters.formatMoney(1*t.payablePriceNotTax*(1+t.tax/100))):(t.paymentPriceNotTax=this.$options.filters.formatMoney(1*t.paymentPrice/(1+t.tax/100)),t.payablePriceNotTax=this.$options.filters.formatMoney(1*t.payablePrice/(1+t.tax/100))),t.discountPrice=this.$options.filters.formatMoney(t.payablePrice-t.paymentPrice),t.discountPriceNotTax=this.$options.filters.formatMoney(t.payablePriceNotTax-t.paymentPriceNotTax)},handleBatchAllMoney:function handleBatchAllMoney(){var _this8=this,obj=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(obj)&&_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isObject(obj)){var key=obj.key,data=obj.data||0;_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(this.formTemp.data,(function(item){_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(item.oldValue)&&(item.oldValue=Object(D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_15__["a"])({},item));var value=_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(item.oldValue)?item[key]:item.oldValue[key];item[key]=_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(obj.operator)?data:eval("".concat(value).concat(obj.operator).concat(data));var unitPrice=item.unitPrice||0,price=item.number*unitPrice*Number((item.discount/10).toFixed(2));item.payablePrice=_this8.$options.filters.formatMoney(item.number*unitPrice),item.paymentPrice=_this8.$options.filters.formatMoney(price),1===item.taxType?(item.paymentPriceNotTax=item.paymentPrice,item.paymentPrice=_this8.$options.filters.formatMoney(1*item.paymentPriceNotTax*(1+item.tax/100)),item.payablePriceNotTax=item.payablePrice,item.payablePrice=_this8.$options.filters.formatMoney(1*item.payablePriceNotTax*(1+item.tax/100))):(item.paymentPriceNotTax=_this8.$options.filters.formatMoney(1*item.paymentPrice/(1+item.tax/100)),item.payablePriceNotTax=_this8.$options.filters.formatMoney(1*item.payablePrice/(1+item.tax/100))),item.discountPrice=_this8.$options.filters.formatMoney(item.payablePrice-item.paymentPrice),item.discountPriceNotTax=_this8.$options.filters.formatMoney(item.payablePriceNotTax-item.paymentPriceNotTax)}))}},handleSumbitPurchaseCheck:function(){this.formData.status=2,this.handleSumbitCheck()},handlePayChange:function(e){1===e?this.formData.payMoney=0:3===e&&(this.formData.payMoney=this.formData.money)},handleSumbitCheck:function(){var e=this,t=Object(D_wwwroot_saas_vue_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_15__["a"])({},this.formData);_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(t.startTime)||(t.startTime=this.$options.filters.formTimestamp(t.startTime)),_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(t.endTime)||(t.endTime=this.$options.filters.formTimestamp(t.endTime)),t.money=1*this.$options.filters.formatMoney(100*t.money),t.payMoney=1*this.$options.filters.formatMoney(100*t.payMoney);var a=[],r=!1,o="";_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].each(this.formTemp.data,(function(n){_common_utils_lodash__WEBPACK_IMPORTED_MODULE_17__["a"].isEmpty(n.unitPrice)&&!r&&(r=!0,o="".concat(n.label," ").concat(n.name," ").concat(e.$t("dt.form.PurchaseUnitPrice")).concat(e.$t("dt.api.notEmpty"))),a.push({id:n.id||null,productId:n.productId,skuId:n.skuId,label:n.label,name:n.name,skuPicture:n.skuPicture,number:n.number,tax:n.tax,taxType:n.taxType,branchId:t.branchId,unitPrice:1*e.$options.filters.formatMoney(100*n.unitPrice),discount:n.discount,payablePrice:1*e.$options.filters.formatMoney(100*n.payablePrice),payablePriceNotTax:1*e.$options.filters.formatMoney(100*n.payablePriceNotTax),discountPrice:1*e.$options.filters.formatMoney(100*n.discountPrice),discountPriceNotTax:1*e.$options.filters.formatMoney(100*n.discountPriceNotTax),paymentPrice:1*e.$options.filters.formatMoney(100*n.paymentPrice),paymentPriceNotTax:1*e.$options.filters.formatMoney(100*n.paymentPriceNotTax)})})),!0!==r?(t.detail=a,t.number=this.formData.detail.map((function(e){return e.number})).reduce((function(e,t){return e+t}),0),this.handleSumbit(t)):this.$Notice.warning({title:this.$t("dt.toast.tips"),desc:o})}}}},"6b9c":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Select",{attrs:{clearable:e.clearable,multiple:e.multiple,disabled:e.disabled,readonly:e.readonly,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.ParentBranch")})},on:{"on-change":e.handleFilterChange},model:{value:e.branchId,callback:function(t){e.branchId=t},expression:"branchId"}},e._l(e.formTemp.data,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)},o=[],n=(a("422c"),a("1f90"),a("4c09")),_=(a("6a61"),a("2e91")),i=a("b8f9"),s={name:"Address",data:function(){return{branchId:null,formTemp:{data:[]}}},props:{clearable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},value:null,callback:null},computed:{},created:function(){this.$isHasMenuAuth("admin.BranchList")&&this.handleBranchList()},mounted:function(){this.branchId=this.value},watch:{},methods:{handleBranchTypeList:function(){var e=this;return Object(_["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$Http.Post({mutation:e.$Model.BranchTypes,variables:{perPage:0,filter:{userId:e.$UserInfo.id}},fields:[{data:["id","branchs.id","branchs.name"]}]}).then((function(e){var t=e.data||{},a=[];return t.data.forEach((function(e){var t;return(t=a).push.apply(t,Object(n["a"])(e.branchs))})),a=i["a"].uniqBy(a,"id"),{data:a}}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},handleBranchList:function(){var e=this;return Object(_["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=[],2!==e.$UserInfo.super||!0!==e.$UserInfo.admin){t.next=7;break}return t.next=4,e.$Http.Post({mutation:e.$Model.Branchs,variables:{perPage:0},fields:[{data:["id","name"]}]}).then((function(e){return e.data}));case 4:a=t.sent,t.next=11;break;case 7:if(!0!==e.$UserInfo.tyeAdmin){t.next=11;break}return t.next=10,e.handleBranchTypeList();case 10:a=t.sent;case 11:e.formTemp.data=a.data;case 12:case"end":return t.stop()}}),t)})))()},handleFilterChange:function(e){this.$emit("input",e),!i["a"].isEmpty(this.callback)&&i["a"].isFunction(this.callback)&&this.callback(e)}}},l=s,d=a("c701"),c=Object(d["a"])(l,r,o,!1,null,"3f3d2be0",null);t["a"]=c.exports},"9c05":function(e,t,a){"use strict";var r=a("47c2"),o=a("d376"),n=a("d49d"),_=a("3f5a"),i=a("38f9"),s=a("936a");r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=n(this),a=_(t.length),r=s(t,0);return r.length=o(r,t,t,a,0,void 0===e?1:i(e)),r}})},c627:function(e,t,a){var r=a("3592");r("flat")},d376:function(e,t,a){"use strict";var r=a("6db8"),o=a("3f5a"),n=a("7144"),_=function(e,t,a,i,s,l,d,c){var m,u=s,p=0,h=!!d&&n(d,c,3);while(p<i){if(p in a){if(m=h?h(a[p],p,t):a[p],l>0&&r(m))u=_(e,t,m,o(m.length),u,l-1)-1;else{if(u>=9007199254740991)throw TypeError("Exceed the acceptable array length");e[u]=m}u++}p++}return u};e.exports=_},dc9e:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-content-layer"},[a("Tabs",{staticClass:"tabs",attrs:{type:"card"}},[a("TabPane",{attrs:{label:e.tabName[0]}},[a("div",{staticClass:"tab-layer"},[a("div",{staticClass:"item",class:{active:1===e.active},on:{click:function(t){e.active=1}}},[e._v(e._s(e.$t("dt.form.Basic")))]),a("div",{staticClass:"item",class:{active:2===e.active},on:{click:function(t){e.active=2}}},[e._v(e._s(e.$t("dt.form.ProductList")))])]),a("Form",{ref:"form",staticClass:"form-page",attrs:{"label-position":"right","label-width":100,model:e.formData,rules:e.ruleInline}},[a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}]},[a("Col",{staticClass:"input-item form-item-flex",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("name",e.formModel.hide),expression:"!$FormCheck('name', formModel.hide)"}],style:{flex:e.$UserInfo.admin?1:.5},attrs:{label:e.$t("dt.form.PurchaseOrderName"),prop:"name"}},[a("Input",{attrs:{readonly:e.$FormCheck("name",e.formModel.readonly),clearable:!e.$FormCheck("name",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.PurchaseOrderName")})},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("branchId",e.formModel.hide)&&!0===e.$UserInfo.admin,expression:"!$FormCheck('branchId', formModel.hide) && $UserInfo.admin === true"}],attrs:{label:""+e.$t("dt.form.ParentBranch"),prop:"branchId"}},[a("e-branch",{attrs:{clearable:!1,readonly:void 0!==e.id,disabled:void 0!==e.id,multiple:!1},on:{callback:e.handleFilterBranchChange},model:{value:e.formData.branchId,callback:function(t){e.$set(e.formData,"branchId",t)},expression:"formData.branchId"}}),e.isReadonly||!e.$isHasMenuAuth("admin.BranchAdd")||e.id?e._e():a("span",{staticClass:"no-flex",on:{click:function(t){e.handleCheckHabitType({name:"admin.BranchAdd",query:{dt:e.$SetDtLink(e.$route,e.$store.state)}})}}},[e._v(" "+e._s(e.$t("dt.form.add"))+" ")])],1)],1),a("Col",{staticClass:"input-item form-item-flex",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("tyeId",e.formModel.hide),expression:"!$FormCheck('tyeId', formModel.hide)"}],attrs:{label:e.$t("dt.form.PurchaseOrderType"),prop:"tyeId"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.PurchaseOrderType")}),route:"PurchaseOrderTypeAdd",type:2,api:e.$Model.PurchaseOrderTypes,column:[{name:e.$t("dt.form.PurchaseOrderType")},{remark:e.$t("dt.base.remark")}],attrs:{label:"name",value:"id"},readonly:e.$FormCheck("tyeId",e.formModel.readonly),clearable:!e.$FormCheck("tyeId",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.PurchaseOrderType")})},model:{value:e.formData.tyeId,callback:function(t){e.$set(e.formData,"tyeId",t)},expression:"formData.tyeId"}})],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("supplyId",e.formModel.hide),expression:"!$FormCheck('supplyId', formModel.hide)"}],attrs:{label:e.$t("dt.form.Supply"),prop:"supplyId"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.Supply")}),route:"SupplyAdd",type:2,api:e.$Model.Supplys,column:[{name:e.$t("dt.form.SupplyName")},{telPhone:e.$t("dt.base.telPhone")},{remark:e.$t("dt.base.remark")}],attrs:{label:"name",value:"id"},readonly:e.$FormCheck("supplyId",e.formModel.readonly),clearable:!e.$FormCheck("supplyId",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.Supply")})},model:{value:e.formData.supplyId,callback:function(t){e.$set(e.formData,"supplyId",t)},expression:"formData.supplyId"}})],1)],1),a("Col",{staticClass:"input-item form-item-flex",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("startTime",e.formModel.hide),expression:"!$FormCheck('startTime', formModel.hide)"}],attrs:{label:e.$t("dt.form.PurchaseStartTime"),prop:"startTime"}},[a("DatePicker",{attrs:{type:"date",disabled:e.$FormCheck("startTime",e.formModel.readonly),readonly:e.$FormCheck("startTime",e.formModel.readonly),clearable:!e.$FormCheck("startTime",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.PurchaseStartTime")})},model:{value:e.formData.startTime,callback:function(t){e.$set(e.formData,"startTime",t)},expression:"formData.startTime"}})],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("endTime",e.formModel.hide),expression:"!$FormCheck('endTime', formModel.hide)"}],attrs:{label:e.$t("dt.form.PurchaseEndTime"),prop:"endTime"}},[a("DatePicker",{attrs:{type:"date",disabled:e.$FormCheck("endTime",e.formModel.readonly),readonly:e.$FormCheck("endTime",e.formModel.readonly),clearable:!e.$FormCheck("endTime",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.PurchaseEndTime")})},model:{value:e.formData.endTime,callback:function(t){e.$set(e.formData,"endTime",t)},expression:"formData.endTime"}})],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("remark",e.formModel.hide),expression:"!$FormCheck('remark', formModel.hide)"}],staticClass:"input-item form-item-flex",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{attrs:{label:e.$t("dt.base.remark"),prop:"remark"}},[a("Input",{attrs:{readonly:e.$FormCheck("remark",e.formModel.readonly),clearable:!e.$FormCheck("remark",e.formModel.readonly),maxlength:"255","show-word-limit":"",type:"textarea",rows:4,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.base.remark")})},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2===e.active,expression:"active === 2"}]},[a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("productIds",e.formModel.hide),expression:"!$FormCheck('productIds', formModel.hide)"}],staticClass:"input-item",attrs:{xs:24,sm:24,md:24,lg:24,xl:22,xxl:22}},[a("FormItem",{attrs:{label:e.$t("dt.form.SelectProduct"),prop:"productIds"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.ProductName")}),route:"ProductAdd",api:e.$Model.Products,column:[{name:e.$t("dt.form.ProductName")},{describe:e.$t("dt.base.describe")}],merge:["relationSku.id","relationSku.label","relationSku.skuPicture"],attrs:{label:"name",value:"id"},filter:{state:1},callback:e.handleProductDataFunc,readonly:e.$FormCheck("productIds",e.formModel.readonly),clearable:!e.$FormCheck("productIds",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.ProductName")})},model:{value:e.formData.productIds,callback:function(t){e.$set(e.formData,"productIds",t)},expression:"formData.productIds"}})],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("money",e.formModel.hide),expression:"!$FormCheck('money', formModel.hide)"}],staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",{attrs:{label:e.$t("dt.form.PurchaseMoney"),prop:"money"}},[a("Input",{attrs:{number:"",type:"number",readonly:!0,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.PurchaseMoney")})},model:{value:e.formData.money,callback:function(t){e.$set(e.formData,"money",t)},expression:"formData.money"}}),a("span",[e._v(e._s(e.$t("dt.base.unit")))])],1)],1),e.formTemp.productList.length>0||e.formTemp.data.length>0?a("Col",{staticClass:"input-item",attrs:{span:24}},[a("FormItem",[a("div",{staticClass:"drag-table"},[a("Col",{directives:[{name:"show",rawName:"v-show",value:e.formTemp.productList.length>0&&!e.isReadonly,expression:"formTemp.productList.length > 0 && !isReadonly"}],staticClass:"drag-layer",attrs:{xs:24,sm:24,md:24,lg:24,xl:22,xxl:22}},[a("Tag",{attrs:{color:"default"}},[e._v(e._s(e.$t("dt.toast.GragRowChange")))]),a("ul",{staticClass:"list"},[a("draggable",{attrs:{list:e.formTemp.productList},on:{change:e.handleProductGragChange}},e._l(e.formTemp.productList,(function(t,r){return a("li",{key:t.id,staticClass:"item"},[a("span",{staticClass:"name"},[a("Checkbox",{attrs:{indeterminate:t.indeterminate,value:t.checkAll},nativeOn:{click:function(a){return a.preventDefault(),e.handleCheckAll(t,r)}}},[e._v(" "+e._s(t.name)+" ")])],1),a("span",{staticClass:"data"},[a("CheckboxGroup",{on:{"on-change":e.handleCurrentProductChange},model:{value:t.data,callback:function(a){e.$set(t,"data",a)},expression:"item.data"}},[a("draggable",{attrs:{list:t.relationSku},on:{change:e.handleCurrentProductChange}},e._l(t.relationSku,(function(t){return a("Checkbox",{key:t.id,attrs:{label:t.id}},[e._v(" "+e._s(t.label)+" ")])})),1)],1)],1)])})),0)],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:e.formTemp.data.length>0,expression:"formTemp.data.length > 0"}],staticClass:"table-layer",attrs:{xs:24,sm:24,md:24,lg:24,xl:22,xxl:22}},[a("Table",{ref:"selection",staticClass:"table-body",attrs:{border:"",loading:e.loading&&e.isMethodList,"max-height":500,"show-summary":!0,"summary-method":e.handleTableSummary,columns:e.columns,"span-method":e.handleSpan,data:e.formTemp.data}})],1)],1)])],1):e._e()],1),a("Col",{staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",[!e.isReadonly&&e.$isHasMenuAuth("admin.PurchaseOrderAdd")||!e.isReadonly&&e.$isHasMenuAuth("admin.PurchaseOrderEdit")?a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleSumbitCheck}},[e._v(" "+e._s(e.btnTitle)+" ")]):e._e(),!e.isReadonly&&e.$isHasMenuAuth("admin.PurchaseOrderAdd")||!e.isReadonly&&e.$isHasMenuAuth("admin.PurchaseOrderEdit")?a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"warning",loading:e.loading},on:{click:e.handleSumbitPurchaseCheck}},[e._v(" "+e._s(e.$t("dt.form.saveAndPurchase"))+" ")]):e.$isHasMenuAuth("admin.PurchaseOrderEdit")&&1===e.formData.status?a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.handleCheckHabitType({name:"admin.PurchaseOrderEdit",params:{id:e.id}})}}},[e._v(" "+e._s(e.$t("dt.form.edit"))+" ")]):e._e(),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleRouteGoBack("admin.PurchaseOrderList")}}},[e._v(e._s(e.$t("dt.base.back")))])],1)],1)],1)],1)],1)],1)},o=[],n=a("40a6"),_=n["a"],i=(a("2cbc"),a("c701")),s=Object(i["a"])(_,r,o,!1,null,"382fc8dc",null);t["a"]=s.exports},fd06:function(e,t,a){}}]);