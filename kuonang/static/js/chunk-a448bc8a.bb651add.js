(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a448bc8a"],{"44c7":function(e,t,a){"use strict";a("f768")},"4ec25":function(e,t,a){"use strict";a("6a61");var r=a("2e91"),o=a("d211"),n=a("5880"),l=a("b8f9"),i={data:function(){return{id:null,isReadonly:!1,formData:{branchId:this.$UserInfo.bid,state:!0,weight:1}}},props:{formData_bak:{type:Object,default:function(){return{}}},formModel:{type:Object,default:function(){return{}}},btnTitle:{type:String,default:""},tabName:{type:Array,default:function(){return[null]}}},created:function(){this.id=this.$GetParamsId(this),this.$FormCheck("*",this.formModel.readonly)&&(this.isReadonly=!0,this.ruleInline={})},computed:Object(o["a"])({},Object(n["mapState"])("base",{loading:function(e){return e.loading},isMethodList:function(e){return e.isMethodList}})),methods:{handleEmitData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.formData;this.$store.commit("popupModel/pageModal",{pageModal:!1}),this.$emit("formDataSubmit",{data:e})},handleFilterBranchChange:function(e){l["a"].isEmpty(e)||(this.formData.branchId=e)},handleSumbit:function(){var e=arguments,t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var o,n,i,d,s,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=e.length>0&&void 0!==e[0]?e[0]:t.formData,n=e.length>1&&void 0!==e[1]?e[1]:"form",o.state=!0===o.state||1*o.state===1?1:2,i=!0,d=!1,!l["a"].isString(n)){a.next=16;break}if(t.$refs[n]){a.next=11;break}i=!1,d=!0,a.next=14;break;case 11:return a.next=13,t.$refs[n].validate((function(e){return e}));case 13:d=a.sent;case 14:a.next=22;break;case 16:if(!l["a"].isArray(n)){a.next=22;break}return s=!0,l["a"].each(n,function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$refs[a]?t.$refs[a].validate((function(e){!1===e&&!0===s&&(s=!1)})):(i=!1,s=!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.next=21,s;case 21:d=a.sent;case 22:if(!1!==i||!0!==d){a.next=25;break}return t.handleEmitData(o),a.abrupt("return");case 25:if(!1!==d){a.next=28;break}return t.$Message.error(t.$t("dt.form.checkFormComplete")),a.abrupt("return");case 28:u=t.$store.state.popupModel.pageModal,!0===u&&t.$store.commit("popupModel/loadData",{loadData:!0}),t.handleEmitData(o);case 31:case"end":return a.stop()}}),a)})))()}}};t["a"]=i},"6b9c":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Select",{attrs:{clearable:e.clearable,multiple:e.multiple,disabled:e.disabled,readonly:e.readonly,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.ParentBranch")})},on:{"on-change":e.handleFilterChange},model:{value:e.branchId,callback:function(t){e.branchId=t},expression:"branchId"}},e._l(e.formTemp.data,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)},o=[],n=(a("422c"),a("1f90"),a("4c09")),l=(a("6a61"),a("2e91")),i=a("b8f9"),d={name:"Address",data:function(){return{branchId:null,formTemp:{data:[]}}},props:{clearable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},value:null,callback:null},computed:{},created:function(){this.$isHasMenuAuth("admin.BranchList")&&this.handleBranchList()},mounted:function(){this.branchId=this.value},watch:{},methods:{handleBranchTypeList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$Http.Post({mutation:e.$Model.BranchTypes,variables:{perPage:0,filter:{userId:e.$UserInfo.id}},fields:[{data:["id","branchs.id","branchs.name"]}]}).then((function(e){var t=e.data||{},a=[];return t.data.forEach((function(e){var t;return(t=a).push.apply(t,Object(n["a"])(e.branchs))})),a=i["a"].uniqBy(a,"id"),{data:a}}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},handleBranchList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=[],2!==e.$UserInfo.super||!0!==e.$UserInfo.admin){t.next=7;break}return t.next=4,e.$Http.Post({mutation:e.$Model.Branchs,variables:{perPage:0},fields:[{data:["id","name"]}]}).then((function(e){return e.data}));case 4:a=t.sent,t.next=11;break;case 7:if(!0!==e.$UserInfo.tyeAdmin){t.next=11;break}return t.next=10,e.handleBranchTypeList();case 10:a=t.sent;case 11:e.formTemp.data=a.data;case 12:case"end":return t.stop()}}),t)})))()},handleFilterChange:function(e){this.$emit("input",e),!i["a"].isEmpty(this.callback)&&i["a"].isFunction(this.callback)&&this.callback(e)}}},s=d,u=a("c701"),c=Object(u["a"])(s,r,o,!1,null,"3f3d2be0",null);t["a"]=c.exports},e5f0:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-content-layer"},[a("Tabs",{staticClass:"tabs",attrs:{type:"card"}},[a("TabPane",{attrs:{label:e.tabName[0]}},[a("Form",{ref:"form",staticClass:"form-page",attrs:{"label-position":"right","label-width":100,model:e.formData,rules:e.ruleInline}},[a("Col",{staticClass:"input-item form-item-flex",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("orderNo",e.formModel.hide)&&void 0!==e.id,expression:"!$FormCheck('orderNo', formModel.hide) && id !== undefined"}],attrs:{label:e.$t("dt.form.OrderNo"),prop:"orderNo"}},[a("Input",{attrs:{readonly:e.$FormCheck("orderNo",e.formModel.readonly)||void 0!==e.id,clearable:!e.$FormCheck("orderNo",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.OrderNo")})},model:{value:e.formData.orderNo,callback:function(t){e.$set(e.formData,"orderNo",t)},expression:"formData.orderNo"}})],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("tye",e.formModel.hide),expression:"!$FormCheck('tye', formModel.hide)"}],style:{flex:void 0===e.id?.5:1},attrs:{label:e.$t("dt.form.RevokeProductType"),prop:"tye"}},[a("Select",{attrs:{readonly:e.$FormCheck("tye",e.formModel.readonly),disabled:e.$FormCheck("tye",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.RevokeProductType")})},on:{"on-change":e.handleRevokeProductTypeChange},model:{value:e.formData.tye,callback:function(t){e.$set(e.formData,"tye",t)},expression:"formData.tye"}},e._l(e.$options.filters.revokeProductType([]),(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1)],1)],1),a("Col",{staticClass:"input-item form-item-flex",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("money",e.formModel.hide),expression:"!$FormCheck('money', formModel.hide)"}],style:{flex:e.$UserInfo.admin?1:.5},attrs:{label:e.$t("dt.form.RevokeMoney"),prop:"money"}},[a("Input",{attrs:{readonly:!0},model:{value:e.formData.money,callback:function(t){e.$set(e.formData,"money",t)},expression:"formData.money"}}),a("span",[e._v(e._s(e.$t("dt.base.unit")))])],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("branchId",e.formModel.hide)&&!0===e.$UserInfo.admin,expression:"!$FormCheck('branchId', formModel.hide) && $UserInfo.admin === true"}],attrs:{label:""+e.$t("dt.form.ParentBranch"),prop:"branchId"}},[a("e-branch",{attrs:{clearable:!1,readonly:void 0!==e.id,disabled:void 0!==e.id,multiple:!1},on:{callback:e.handleFilterBranchChange},model:{value:e.formData.branchId,callback:function(t){e.$set(e.formData,"branchId",t)},expression:"formData.branchId"}}),e.isReadonly||!e.$isHasMenuAuth("admin.BranchAdd")||e.id?e._e():a("span",{staticClass:"no-flex",on:{click:function(t){e.handleCheckHabitType({name:"admin.BranchAdd",query:{dt:e.$SetDtLink(e.$route,e.$store.state)}})}}},[e._v(" "+e._s(e.$t("dt.form.add"))+" ")])],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("remark",e.formModel.hide),expression:"!$FormCheck('remark', formModel.hide)"}],staticClass:"input-item",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{attrs:{label:e.$t("dt.base.remark"),prop:"remark"}},[a("Input",{attrs:{readonly:e.$FormCheck("remark",e.formModel.readonly),clearable:!e.$FormCheck("remark",e.formModel.readonly),maxlength:"255","show-word-limit":"",type:"textarea",rows:4,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.base.remark")})},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1),a("Col",{staticClass:"input-item form-item-flex",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("purchaseId",e.formModel.hide)&&1===e.formData.tye,expression:"!$FormCheck('purchaseId', formModel.hide) && formData.tye === 1"}],attrs:{label:e.$t("dt.form.PurchaseOrder"),prop:"purchaseId"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.PurchaseOrder")}),route:"PurchaseOrderAdd",readonly:e.$FormCheck("purchaseId",e.formModel.readonly),api:e.$Model.PurchaseOrders,column:[{name:e.$t("dt.form.PurchaseOrder")},{number:e.$t("dt.form.PurchaseNumber")},{putNumber:e.$t("dt.form.PutNumber")},{revokeNumber:e.$t("dt.form.RevokeProductNumber")},{remark:e.$t("dt.base.remark")}],merge:["money","supply.id","supply.code","supply.name","detail.id","detail.skuId","detail.label","detail.name","detail.number","detail.skuPicture","detail.revokeNumber","detail.paymentPrice","detail.putStock.id","detail.putStock.number"],attrs:{label:"name",value:"id"},filter:{status_in:[2,3]},callback:e.handleOrderDataFunc,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.PurchaseOrder")})},model:{value:e.formData.purchaseId,callback:function(t){e.$set(e.formData,"purchaseId",t)},expression:"formData.purchaseId"}})],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("supplyId",e.formModel.hide)&&e.formData.purchaseId&&1===e.formData.tye,expression:"!$FormCheck('supplyId', formModel.hide) && formData.purchaseId && formData.tye === 1"}],attrs:{label:e.$t("dt.form.RevokeProductSupply"),prop:"supplyId"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.RevokeProductSupply")}),route:"SupplyAdd",type:2,readonly:e.$FormCheck("supplyId",e.formModel.readonly)||1===e.formData.tye,clearable:!1,api:e.$Model.Supplys,column:[{name:e.$t("dt.form.SupplyName")},{code:e.$t("dt.form.SupplyCode")},{remark:e.$t("dt.base.remark")}],attrs:{label:"name",value:"id"},placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.RevokeProductSupply")})},model:{value:e.formData.supplyId,callback:function(t){e.$set(e.formData,"supplyId",t)},expression:"formData.supplyId"}})],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("salesOrderId",e.formModel.hide)&&2===e.formData.tye,expression:"!$FormCheck('salesOrderId', formModel.hide) && formData.tye === 2"}],staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",{attrs:{label:e.$t("dt.form.SalesOrder"),prop:"salesOrderId"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.SalesOrder")}),route:"SalesOrderAdd",readonly:e.$FormCheck("salesOrderId",e.formModel.readonly),api:e.$Model.SalesOrders,column:[{orderNo:e.$t("dt.form.OrderNo")},{money:e.$t("dt.form.SalesOrderMoney"),filters:"money"},{customer:{name:e.$t("dt.form.CustomerName")}},{createdAt:e.$t("dt.form.OrderTime"),filters:"formatTime"}],merge:["detail.id","detail.skuId","detail.label","detail.name","detail.number","detail.skuPicture","detail.revokeNumber","detail.unitPrice","detail.paymentPrice"],attrs:{label:"orderNo",value:"id"},filter:{status_in:[3,4]},callback:e.handleSalesOrderDataFunc,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.SalesOrder")})},model:{value:e.formData.salesOrderId,callback:function(t){e.$set(e.formData,"salesOrderId",t)},expression:"formData.salesOrderId"}})],1)],1),a("Col",{staticClass:"input-item form-item-flex",attrs:{xs:24,sm:24,md:20,lg:16,xl:14,xxl:12}},[a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("supplyId",e.formModel.hide)&&3===e.formData.tye,expression:"!$FormCheck('supplyId', formModel.hide) && formData.tye === 3"}],attrs:{label:e.$t("dt.form.RevokeProductSupply"),prop:"supplyId"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.RevokeProductSupply")}),route:"SupplyAdd",type:2,readonly:e.$FormCheck("supplyId",e.formModel.readonly),api:e.$Model.Supplys,column:[{name:e.$t("dt.form.SupplyName")},{code:e.$t("dt.form.SupplyCode")},{remark:e.$t("dt.base.remark")}],attrs:{label:"name",value:"id"},placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.RevokeProductSupply")})},model:{value:e.formData.supplyId,callback:function(t){e.$set(e.formData,"supplyId",t)},expression:"formData.supplyId"}})],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("warehouseId",e.formModel.hide)&&3===e.formData.tye,expression:"!$FormCheck('warehouseId', formModel.hide) && formData.tye === 3"}],attrs:{label:e.$t("dt.form.Warehouse"),prop:"warehouseId"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.Warehouse")}),route:"WarehouseAdd",type:2,readonly:e.$FormCheck("warehouseId",e.formModel.readonly)||1===e.formData.tye,api:e.$Model.Warehouses,column:[{name:e.$t("dt.form.WarehouseName")},{code:e.$t("dt.form.WarehouseCode")},{remark:e.$t("dt.base.remark")}],attrs:{label:"name",value:"id"},callback:e.handleWarehouseDataFunc,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.Warehouse")})},model:{value:e.formData.warehouseId,callback:function(t){e.$set(e.formData,"warehouseId",t)},expression:"formData.warehouseId"}})],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:e.formData.supplyId&&e.formTemp.data.length>0||2===e.formData.tye&&e.formTemp.data.length>0||3===e.formData.tye&&e.formData.warehouseId,expression:"formData.supplyId && formTemp.data.length > 0 || formData.tye === 2 && formTemp.data.length > 0 || formData.tye === 3 && formData.warehouseId"}],staticClass:"input-item",attrs:{xs:24,sm:24,md:24,lg:24,xl:22,xxl:22}},[a("FormItem",[a("div",[a("Tag",[e._v(e._s(e.$t("dt.toast.SelectRevokeProductProduct")))]),a("Table",{ref:"selection",staticClass:"table-body",attrs:{border:"",loading:e.loading&&e.isMethodList,"max-height":500,columns:e.columns,"span-method":e.handleSpan,data:e.formTemp.data},on:{"on-select-cancel":e.handleTableOnSelectCancel,"on-selection-change":e.handleTableSelectionChange}})],1)])],1),a("Col",{staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",[!e.isReadonly&&e.$isHasMenuAuth("admin.RevokeProductAdd")||!e.isReadonly&&e.$isHasMenuAuth("admin.RevokeProductEdit")?a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleSumbitCheck}},[e._v(" "+e._s(e.btnTitle)+" ")]):e._e(),!e.isReadonly&&e.$isHasMenuAuth("admin.RevokeProductAdd")&&1===e.formData.status||!e.isReadonly&&e.$isHasMenuAuth("admin.RevokeProductEdit")&&1===e.formData.status?a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"warning",loading:e.loading},on:{click:e.handleSumbitRevokeCheck}},[e._v(" "+e._s(e.$t("dt.form.saveAndRevoke"))+" ")]):e.$isHasMenuAuth("admin.RevokeProductEdit")&&1===e.formData.status?a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.handleCheckHabitType({name:"admin.RevokeProductEdit",params:{id:e.id}})}}},[e._v(" "+e._s(e.$t("dt.form.edit"))+" ")]):e._e(),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleRouteGoBack("admin.RevokeProductList")}}},[e._v(e._s(e.$t("dt.base.back")))])],1)],1)],1)],1)],1)],1)},o=[],n=(a("2d38"),a("2c78"),a("9953"),a("69bf"),a("02bf"),a("a39b"),a("90d4"),a("5c4c"),a("d211")),l=a("b8f9"),i=a("4ec25"),d=a("6b9c"),s=a("494e"),u={name:"RevokeProductModel",mixins:[i["a"]],data:function(){var e=this;return{currentProduct:[],currentOrder:{money:0},tableMultipleSelect:[],formTemp:{data:[],oldData:[],productList:[]},formData:{supplyId:null,salesOrderId:null,warehouseId:null,tye:1,status:1,money:0,userId:this.$UserInfo.id},columns:[{type:"selection",width:60,align:"center",fixed:"left"},{title:this.$t("dt.form.index"),type:"index",width:80,align:"center"},{title:this.$t("dt.form.Product"),oldTitle:this.$t("dt.form.Product"),align:"center",children:[{title:this.$t("dt.form.name"),key:"label",minWidth:120,align:"center"},{title:this.$t("dt.form.Spec"),key:"name",minWidth:120,align:"center",render:function(t,a){return t("span",a.row.name||e.$t("dt.base.Nothing"))}}]},{title:this.$t("dt.form.SkuPicture"),key:"skuPicture",width:100,align:"center",render:function(t,a){var r=t("Avatar",{props:{shape:"square",icon:"ios-images"}});return l["a"].isEmpty(e.formTemp.data[a.index][a.column.key])||(r=t("Avatar",{props:{shape:"square",src:e.$options.filters.formatImage(e.formTemp.data[a.index][a.column.key])}})),r}},{title:this.$t("dt.form.SupplyCode"),key:"code",width:120,align:"center",renderHeader:function(t,a){var r=a.column;return e.formTemp.data.length<=0?t("span",r.title):t("div",[t("span",r.title),t("Tooltip",{props:{transfer:!0,placement:"top",maxWidth:"205",content:e.$t("dt.toast.GoodsSignSupplyCodeCheck")}},[t("Icon",{props:{size:"16",color:"#f90",type:"ios-alert-outline"}})])])}},{title:this.$t("dt.form.PurchaseNumber"),key:"purchaseNumber",width:100,align:"center"},{title:this.$t("dt.form.CanRevokeNumber"),key:"notPutStock",width:100,align:"center"},{title:this.$t("dt.base.UnitPrice"),key:"unitPrice",width:120,align:"center",render:function(t,a){var r=a.row.unitPrice;return e.id&&e.isReadonly?t("span",r):t("InputNumber",{props:{value:r,size:"small",min:0,clearable:!0,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.RevokeMoney")})},on:{input:function(t){e.handleCheckMoney(t,a.index,a.column.key)}}},r)}},{title:this.$t("dt.form.RevokeMoney"),key:"money",width:120,align:"center",render:function(t,a){var r=a.row.money;return e.id&&e.isReadonly?t("span",r):t("InputNumber",{props:{value:r,size:"small",min:0,clearable:!0,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.RevokeMoney")})},on:{input:function(t){e.handleCheckMoney(t,a.index,a.column.key)}}},r)}},{title:this.$t("dt.form.RevokeProductNumber"),key:"number",width:120,align:"center",fixed:"right",renderHeader:function(t,a){var r=a.column;return t("div",[t("span",r.title),t("span",{style:{marginLeft:"5px",backgroundColor:"#ecf5ff",color:"#409EFF",cursor:"pointer",display:!e.isReadonly&&e.tableMultipleSelect.length>0?"inline-block":"none"},on:{click:function(){e.handleBatchAllMoney()}}},e.$t("dt.base.All"))])},render:function(t,a){var r=a.row.number;return e.id&&e.isReadonly?t("span",r):t("InputNumber",{props:{value:r,size:"small",min:0,max:a.row.notPutStock,clearable:!0,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.RevokeProductNumber")})},on:{input:function(t){e.handleCheckMoney(t,a.index,a.column.key)}}},r)}}],ruleInline:{branchId:[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.ParentBranch")}),trigger:"blur"}]}}},created:function(){l["a"].isEmpty(this.id)||(this.columns.splice(0,1),this.handleDetail())},mounted:function(){window.aa=this},destroyed:function(){this.$apollo.getClient().cache.reset()},components:{EBranch:d["a"],ListSelectModal:s["a"]},watch:{},methods:{handleDetail:function(){var e=this;this.$Http.Post({mutation:this.$Model.PurchaseRevokeProductDetail,variables:{id:this.id},fields:["id","orderNo","money","branchId","purchaseId","tye","status","remark","weight","state","supplyId","warehouseId","salesOrderId","userId","supply.id","supply.name","supply.code","detail.id","detail.number","detail.money","detail.skuId","detail.purchaseId","detail.sku.id","detail.sku.label","detail.sku.stock","detail.sku.lockStock","detail.sku.product.id","detail.sku.product.name","detail.sku.putStock.id","detail.sku.putStock.number","detail.sku.putStock.supplyId","detail.productDetail.id","detail.productDetail.label","detail.productDetail.name","detail.productDetail.skuPicture","detail.productDetail.number","detail.productDetail.revokeNumber","detail.productDetail.unitPrice","detail.productDetail.putStock.id","detail.productDetail.putStock.number","detail.salesOrderDetail.id","detail.salesOrderDetail.number","detail.salesOrderDetail.revokeNumber","detail.salesOrderDetail.unitPrice"]},(function(){e.$router.push({name:"admin.RevokeProductList"})})).then((function(t){var a=t.data;a.state=1===a.state||!0===a.state,3!==a.tye||e.isReadonly||(e.columns[4].title=e.$t("dt.form.StockNumber")),a.money=1*e.$options.filters.money(1*a.money);var r=[];l["a"].each(a.detail,(function(t){var o=0,n=0,i=t.productDetail||{},d=t.salesOrderDetail||{},s=i.putStock||[],u=t.sku||{},c=u.product||{},m=1*e.$options.filters.money(1*i.unitPrice);if(l["a"].isEmpty(i)&&(m=1*e.$options.filters.money(t.money/t.number)),1===a.tye)e.isReadonly&&e.columns.splice(5,1),o=i.number,l["a"].isEmpty(s)||(n=s.map((function(e){return e.number})).reduce((function(e,t){return e+t}),0)),n=o-n-i.revokeNumber||0,e.columns[4].title=e.$t("dt.form.PurchaseNumber");else if(2===a.tye)o=d.number,n=o-d.revokeNumber||0,m=1*e.$options.filters.money(1*d.unitPrice),e.columns[4].title=e.$t("dt.form.PlaceOrderNumber");else if(3===a.tye){s=u.putStock.filter((function(e){return e.supplyId===a.supplyId}));var p=s.map((function(e){return e.number})).reduce((function(e,t){return e+t}),0),h=u.stock-u.lockStock;n=h>=p?p:h,o=u.stock,e.columns[4].title=e.$t("dt.form.StockNumber")}var f=a.supply||{},b={id:t.id,code:f.code||e.$t("dt.base.Nothing"),number:t.number,money:1*e.$options.filters.money(t.money),skuId:t.skuId,label:i.label||c.name,name:i.name||u.label,productDetailId:i.id,salesOrderDetailId:d.id,skuPicture:u.skuPicture,purchaseNumber:o,notPutStock:n,unitPrice:m};b.notPutStock<=0&&(b._disabled=!0),b.number>n&&!e.isReadonly&&(b.number=n),r.push(b)})),e.tableMultipleSelect=r,e.formTemp.data=r,e.formData=Object(n["a"])(Object(n["a"])({},e.formData),a)}))},handleOrderDataFunc:function(e){var t=this,a=[];this.currentOrder={},this.formData.supplyId=null,l["a"].isEmpty(e)||(this.currentOrder=e[0],this.formData.supplyId=this.currentOrder.supply.id,l["a"].each(e[0].detail,(function(e,r){var o=0,n=e.putStock;l["a"].isEmpty(n)||(o=n.map((function(e){return e.number})).reduce((function(e,t){return e+t}),0));var i=t.$options.filters.formatMoney(e.paymentPrice/e.number,"out"),d={index:r+1,skuId:e.skuId,code:t.currentOrder.supply.code,label:e.label,name:e.name,skuPicture:e.skuPicture,purchaseNumber:e.number,notPutStock:e.number-o-e.revokeNumber||0,number:0,money:0,unitPrice:1*t.$options.filters.money(1*i),paymentPrice:e.paymentPrice,productDetailId:e.id};d.notPutStock<=0&&(d._disabled=!0),a.push(d)}))),1===this.formData.tye&&(this.columns[5].title=this.$t("dt.form.PurchaseNumber")),3===this.formData.tye&&(this.columns[5].title=this.$t("dt.form.StockNumber")),this.formTemp.data=a},handleSalesOrderDataFunc:function(e){var t=this,a=[];l["a"].isEmpty(e)||l["a"].each(e[0].detail,(function(e){var r=t.$options.filters.formatMoney(e.paymentPrice/e.number,"out"),o={skuId:e.skuId,code:t.$t("dt.base.Nothing"),label:e.label,name:e.name,skuPicture:e.skuPicture,purchaseNumber:e.number,notPutStock:e.number-e.revokeNumber||0,number:0,money:0,unitPrice:1*t.$options.filters.money(1*r),paymentPrice:e.paymentPrice,salesOrderDetailId:e.id};a.push(o)})),2===this.formData.tye&&(this.columns[5].title=this.$t("dt.form.PlaceOrderNumber")),this.formTemp.data=a},handleWarehouseDataFunc:function(e){var t=this;if(this.formTemp.data=[],!l["a"].isEmpty(e)){var a=e[0];this.$Http.Post({mutation:this.$Model.WarehouseProducts,variables:{filter:{warehouseId:this.formData.warehouseId}},fields:[{data:["id","stock","lockStock","skuId","sku.id","sku.label","sku.skuPicture","product.id","product.name","warehouse.id","warehouse.old.id","warehouse.old.oldId","warehouse.old.putStock.id","warehouse.old.putStock.skuId","warehouse.old.putStock.number","warehouse.old.putStock.stock.id","warehouse.old.putStock.stock.tye","putStock.id","putStock.number","putStock.supplyId","putStock.warehouseId","putStock.productDetail.id","putStock.productDetail.unitPrice","putStock.stock.id","putStock.stock.tye"]}]},(function(){t.$router.push({name:"admin.RevokeProductList"})})).then((function(e){var r=e.data,o=[];l["a"].each(r.data,(function(e){e.putStock=e.putStock.filter((function(e){return e.warehouseId===t.formData.warehouseId}));var r=e.product||{},n=e.putStock.filter((function(e){return 2!==e.tye})).map((function(e){return e.number})).reduce((function(e,t){return e+t}),0),i=e.stock-e.lockStock,d=e.putStock.filter((function(e){return!l["a"].isEmpty(e.productDetail)})).map((function(e){return e.productDetail.unitPrice})).reduce((function(e,t){return e+t}),0);d=1*t.$options.filters.money(1*d/e.putStock.length);var s={skuId:e.sku.id,code:a.code,label:r.name,name:e.sku.label,money:0,unitPrice:d,purchaseNumber:i,notPutStock:i>=n?n:i,skuPicture:e.sku.skuPicture,number:0};s.notPutStock<=0&&(s._disabled=!0),o.push(s)})),t.formTemp.data=o.filter((function(e){return e.notPutStock>0}))}))}},handleCheckMoney:function(e,t,a){var r=this.$refs.selection.getSelection().filter((function(e){return e.notPutStock>0}));l["a"].each(this.formTemp.data,(function(e){var t=r.findIndex((function(t){return t.skuId===e.skuId}));-1===t&&(e._checked=!1)})),"number"===a&&e>this.formTemp.data[t].notPutStock?this.$Message.warning(this.$t("dt.api.RevokeNumberNotMaxPutStock")):(this.formTemp.data[t][a]=e,this.formTemp.data[t].money=this.formTemp.data[t].number*this.formTemp.data[t].unitPrice,this.formTemp.data[t].number>0?this.formTemp.data[t]._checked=!0:this.formTemp.data[t]._checked=!1,this.tableMultipleSelect=this.formTemp.data.filter((function(e){return!0===e._checked})),this.formData.money=this.tableMultipleSelect.map((function(e){return e.money})).reduce((function(e,t){return e+t}),0))},handleBatchAllMoney:function(){var e=this.$refs.selection.getSelection().filter((function(e){return e.notPutStock>0}));l["a"].each(this.formTemp.data,(function(t){var a=e.findIndex((function(e){return e.skuId===t.skuId}));-1!==a?(t.number=t.notPutStock,t.money=t.number*t.unitPrice):t._checked=!1})),this.tableMultipleSelect=this.formTemp.data.filter((function(e){return!0===e._checked})),this.formData.money=this.tableMultipleSelect.map((function(e){return e.money})).reduce((function(e,t){return e+t}),0)},handleTableOnSelectCancel:function(e,t){this.handleTableRowCancelChecked(t)},handleTableRowCancelChecked:function(e){if(!l["a"].isEmpty(e)){var t=this.formTemp.data.findIndex((function(t){return t.skuId===e.skuId}));-1!==t&&this.$set(this.formTemp.data,t,Object(n["a"])(Object(n["a"])({},this.formTemp.data[t]),{},{_checked:!1}));var a=this.formTemp.data.filter((function(e){return!0===e._checked}));this.tableMultipleSelect=a}},handleTableSelectionChange:function(e){var t=this;this.tableMultipleSelect=e,l["a"].each(this.formTemp.data,(function(a,r){var o=e.findIndex((function(e){return e.skuId===a.skuId}));-1!==o?a._checked=!0:t.$set(t.formTemp.data,r,Object(n["a"])(Object(n["a"])({},t.formTemp.data[r]),{},{_checked:!1}))}))},handleSpan:function(e){var t=e.row,a=e.column,r=e.rowIndex;if(-1===this.currentProduct.map((function(e){return e.label})).indexOf(t[a.key]))return[1,1];var o=t[a.key];if(r>0&&o===this.formTemp.data[r-1][a.key])return[0,0];for(var n=[1,1],l=r+1;l<this.formTemp.data.length&&o===this.formTemp.data[l][a.key];l++)++n[0];return n},handleRevokeProductTypeChange:function(e){this.formTemp.data=[],this.formData.purchaseId=null,this.formData.warehouseId=null,this.formData.supplyId=null,this.formData.salesOrderId=null,1===e?(this.columns[5].title=this.$t("dt.form.PurchaseNumber"),delete this.ruleInline.warehouseId,delete this.ruleInline.salesOrderId,this.ruleInline.purchaseId=[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.PurchaseOrder")}),trigger:"blur"}]):2===e?(delete this.ruleInline.warehouseId,delete this.ruleInline.purchaseId,delete this.ruleInline.supplyId,this.ruleInline.salesOrderId=[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.SalesOrder")}),trigger:"blur"}]):(this.columns[5].title=this.$t("dt.form.StockNumber"),delete this.ruleInline.purchaseId,delete this.ruleInline.salesOrderId,this.ruleInline.warehouseId=[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.Warehouse")}),trigger:"blur"}])},handleSumbitRevokeCheck:function(){this.handleSumbitCheck({status:2})},handleSumbitCheck:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object(n["a"])({},this.formData);1!==this.formData.tye&&(this.formData.purchaseId=null),2!==this.formData.tye&&(this.formData.salesOrderId=null),!l["a"].isEmpty(t)&&l["a"].isObject(t)&&(a=Object(n["a"])(Object(n["a"])({},a),t)),a.money=1*this.$options.filters.formatMoney(100*a.money);var r=[];if(l["a"].each(this.formTemp.data,(function(t){var o=e.tableMultipleSelect.findIndex((function(e){return e.skuId===t.skuId}));-1!==o&&t.number>0&&r.push({id:t.id||null,skuId:t.skuId,number:t.number,money:1*e.$options.filters.formatMoney(100*t.money),productDetailId:t.productDetailId||null,salesOrderDetailId:t.salesOrderDetailId||null,purchaseId:e.formData.purchaseId,branchId:a.branchId})})),l["a"].isEmpty(r))return this.$Notice.warning({title:this.$t("dt.toast.tips"),desc:"".concat(this.$t("dt.form.RevokeProductProject")).concat(this.$t("dt.api.notEmpty"))}),void(this.formData.status=1);a.number=r.map((function(e){return e.number})).reduce((function(e,t){return e+t}),0),a.detail=r,this.handleSumbit(a)}}},c=u,m=(a("44c7"),a("c701")),p=Object(m["a"])(c,r,o,!1,null,"d5a84826",null);t["a"]=p.exports},f768:function(e,t,a){}}]);