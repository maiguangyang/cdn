(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6163d0a3"],{"4ba9":function(t,e,n){"use strict";n("a578")},"662a":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Commission-list-page"},[n("div",{staticClass:"wrapper"},[n("div",{staticClass:"count-layer"},[n("div",{staticClass:"box-group"},[n("div",{staticClass:"box-item"},[n("Commission",{attrs:{title:t.$t("dt.form.CurrentMonth"),month:t.formTemp.currentMonth}})],1),n("div",{staticClass:"box-item"},[n("Commission",{attrs:{title:t.$t("dt.form.LastMonth"),month:t.formTemp.lastMonth}})],1)])]),n("div",{staticClass:"controller"},[n("Row",{staticClass:"filter-group",class:{active:t.rowToggle},attrs:{type:"flex",gutter:20}},[n("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{staticClass:"child-title",attrs:{span:"8"}},[n("span",[t._v(t._s(t.$t("dt.form.OrderNo"))+"：")])]),n("Col",{attrs:{span:"16"}},[n("Input",{attrs:{search:"",placeholder:t.$t("dt.base.pleaseInput",{label:t.$t("dt.form.OrderNo")})},on:{"on-enter":t.handleFilterChange,"on-search":t.handleFilterChange},model:{value:t.filters.orderNo_like,callback:function(e){t.$set(t.filters,"orderNo_like",e)},expression:"filters.orderNo_like"}})],1)],1)],1),n("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{staticClass:"child-title",attrs:{span:"8"}},[n("span",[t._v(t._s(t.$t("dt.form.OrderName"))+"：")])]),n("Col",{attrs:{span:"16"}},[n("Input",{attrs:{search:"",placeholder:t.$t("dt.base.pleaseInput",{label:t.$t("dt.form.OrderName")})},on:{"on-enter":t.handleFilterChange,"on-search":t.handleFilterChange},model:{value:t.filters.name_like,callback:function(e){t.$set(t.filters,"name_like",e)},expression:"filters.name_like"}})],1)],1)],1),n("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{staticClass:"child-title",attrs:{span:"8"}},[n("span",[t._v(t._s(t.$t("dt.form.OrderStatus"))+"：")])]),n("Col",{attrs:{span:"16"}},[n("Select",{attrs:{clearable:"",placeholder:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.form.OrderStatus")})},on:{"on-change":t.handleFilterChange},model:{value:t.filters.status,callback:function(e){t.$set(t.filters,"status",e)},expression:"filters.status"}},t._l(t.$options.filters.dividendOrderStatus([]),(function(e){return n("Option",{key:e.value,attrs:{value:e.value}},[t._v(" "+t._s(e.label)+" ")])})),1)],1)],1)],1),n("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{staticClass:"child-title",attrs:{span:"8"}},[n("span",[t._v(t._s(t.$t("dt.form.ProgramMode"))+"：")])]),n("Col",{attrs:{span:"16"}},[n("Select",{attrs:{clearable:"",placeholder:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.form.ProgramMode")})},on:{"on-change":t.handleFilterChange},model:{value:t.filters.tye,callback:function(e){t.$set(t.filters,"tye",e)},expression:"filters.tye"}},t._l(t.$options.filters.dividendType([]),(function(e){return n("Option",{key:e.value,attrs:{value:e.value}},[t._v(" "+t._s(e.label)+" ")])})),1)],1)],1)],1),n("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{staticClass:"child-title",attrs:{span:"8"}},[n("span",[t._v(t._s(t.$t("dt.form.OrderTime"))+"：")])]),n("Col",{attrs:{span:"16"}},[n("date-sort",{attrs:{attr:["createdAt_gte","createdAt_lte"],placeholder:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.form.StartAndEndTime")})},on:{DatePickerChange:t.handleFilterChange}})],1)],1)],1),n("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{staticClass:"child-title",attrs:{span:"8"}},[n("span",[t._v(t._s(t.$t("dt.base.sort"))+"：")])]),n("Col",{attrs:{span:"16"}},[n("sorts",{on:{swtichSorts:t.handleFilterChange}})],1)],1)],1),n("button",{staticClass:"row-toggle",attrs:{type:"button"},on:{click:function(e){return t.$store.commit("spinShow/rowToggle")}}},[t.rowToggle?n("Icon",{attrs:{type:"ios-arrow-up",size:"25",color:"#999"}}):n("Icon",{attrs:{type:"ios-arrow-down",size:"25",color:"#999"}})],1)],1),n("div",{staticClass:"btn-group"},[n("div",{staticClass:"left"},[n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleModalStatusChange(0)}}},[t._v(" "+t._s(t.$t("dt.form.DividendCount"))+" ")]),n("Button",{attrs:{type:"success"},on:{click:function(e){return t.handleModalStatusChange(1)}}},[t._v(" "+t._s(t.$t("dt.form.MonthSettle"))+" ")])],1),n("div",{staticClass:"right"},[t.$isHasMenuAuth("admin.CommissionExport")?n("Button",{attrs:{type:"warning"},on:{click:t.handleAsyncExport}},[n("Icon",{attrs:{type:"md-cloud-download"}}),t._v(t._s(t.$t("dt.form.export"))+"Excel ")],1):t._e()],1)]),n("div",{staticClass:"table"},[n("Table",{ref:"selection",attrs:{border:"",loading:t.loading&&t.isMethodList,columns:t.columns,data:t.formTemp.data},on:{"on-select-cancel":t.handleTableOnSelectCancel,"on-selection-change":t.handleTableSelectionChange}})],1),n("div",{staticClass:"page-list"},[n("Page",{attrs:{"show-total":"","show-sizer":"","show-elevator":"",total:t.formTemp.total,current:t.formTemp.current_page,"page-size-opts":t.formTemp.pageSizeOpts,"page-size":t.formTemp.per_page},on:{"on-page-size-change":t.handleOnPageSizeChange,"on-change":t.handleChangePage}})],1)],1)]),n("Modal",{attrs:{value:t.dividendCount,transfer:!0,"mask-closable":!1},on:{"on-visible-change":t.handleModalOnVisibleChang}},[n("div",{staticClass:"content",staticStyle:{display:"flex","align-items":"center"}},[n("div",{staticClass:"item",staticStyle:{"margin-right":"10px"}},[n("span",[t._v(t._s(t.$t("dt.base.select",{label:t.$t("dt.base.Year")+t.$t("dt.base.Month")}))+"：")]),n("date-sort",{attrs:{type:"month",attr:["finishTime_gte","finishTime_lte"],options:t.options,placeholder:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.base.Year")+t.$t("dt.base.Month")})},on:{DatePickerChange:t.handleCountMonthChange},model:{value:t.formTemp.month,callback:function(e){t.$set(t.formTemp,"month",e)},expression:"formTemp.month"}})],1),n("div",{staticClass:"item"},[n("span",[t._v(t._s(""+t.$t("dt.base.notHandle")+t.$t("dt.form.Order"))+"：")]),n("span",[t._v(t._s(t.formTemp.orderNumber))])])]),n("div",{staticClass:"foot",attrs:{slot:"footer"},slot:"footer"},[n("Button",{on:{click:function(e){t.dividendCount=!1}}},[t._v(t._s(t.$t("dt.form.cancel")))]),n("Button",{directives:[{name:"show",rawName:"v-show",value:t.formTemp.orderNumber>0,expression:"formTemp.orderNumber > 0"}],attrs:{type:"primary"},on:{click:function(e){return t.handleGenerateCommission()}}},[t._v(t._s(0===t.modalStatus?t.$t("dt.base.GenerateCommissionData"):t.$t("dt.form.StartSettle")))])],1)])],1)},s=[],a=(n("2d38"),n("02bf"),n("5c4c"),n("4798"),n("d8f4"),n("2083"),n("6a61"),n("2e91")),o=n("d211"),r=n("b8f9"),l=n("efa4"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"commission-page"},[n("div",{staticClass:"header"},[n("h3",[t._v(t._s(t.title))]),n("div",{staticClass:"total"},[n("div",{staticClass:"item"},[t._v(" "+t._s(t.$t("dt.form.NotBilling"))+"： "),n("span",{staticClass:"red"},[t._v(t._s(t._f("money")(t.formTemp.not_money)))]),t._v(" "+t._s(t.$t("dt.base.unit"))+" ")]),n("div",{staticClass:"item"},[t._v(" "+t._s(t.$t("dt.form.IsBilling"))+"： "),n("span",{staticClass:"green"},[t._v(t._s(t._f("money")(t.formTemp.money)))]),t._v(" "+t._s(t.$t("dt.base.unit"))+" ")])])]),n("div",{staticClass:"num"},[n("div",{staticClass:"item"},[n("span",[t._v(t._s(t.$t("dt.form.Order"))+"：")]),n("em",[t._v(t._s(t.formTemp.total)+" "+t._s(t.$t("dt.base.piece")))])]),n("div",{staticClass:"item"},[n("span",[t._v(t._s(t.$t("dt.base.Money"))+"：")]),n("em",[t._v(t._s(t._f("money")(t.formTemp.total_money))+" "+t._s(t.$t("dt.base.unit")))])])])])},m=[],c=void 0,u={name:"commission",data:function(){return{formTemp:{total:0,money:0,not_money:0,total_money:0}}},props:{title:{type:String,default:""},month:{type:Array,default:function(){return[c.$options.filters.formatTime(new Date,"YYYYMM")]}}},watch:{month:function(t){r["a"].isEmpty(t)||this.handleCommissionCount()}},computed:{},mounted:function(){r["a"].isEmpty(this.month)||this.handleCommissionCount()},filters:{},methods:{handleCommissionCount:function(){var t=this;return this.$Http.Post({mutation:this.$Model.CommissionCount,variables:{month:this.month}}).then((function(e){var n=e.data;t.formTemp=Object(o["a"])(Object(o["a"])({},t.formTemp),n)}))}}},h=u,p=(n("d581"),n("c701")),f=Object(p["a"])(h,d,m,!1,null,"5a255548",null),v=f.exports,C={name:"RoleList",mixins:[l["a"]],data:function(){return{filters:{status_in:[2,3]},options:{disabledDate:function(t){return t&&t.valueOf()>Date.now()}},modalStatus:null,dividendCount:!1,formTemp:{orderNumber:0,month:null,CommissionTypeList:[],currentMonth:[],lastMonth:[]}}},components:{Commission:v},computed:{columns:function(){var t=this;return[{title:this.$t("dt.form.index"),type:"index",width:80,align:"center"},{title:this.$t("dt.form.OrderNo"),key:"orderNo",width:160,align:"center",render:function(e,n){return e(t.$isHasMenuAuth("admin.CommissionDetail")?"router-link":"span",{props:{to:{name:"admin.CommissionDetail",params:{id:n.row.id}}}},n.row.orderNo)}},{title:this.$t("dt.form.RelatedOrders"),key:"name",minWidth:220,align:"center",render:function(e,n){var i=n.row.name;return e(t.$isHasMenuAuth("admin.SalesOrderDetail")?"router-link":"span",{props:{to:{name:"admin.SalesOrderList",query:{filter:JSON.stringify({orderNo_like:i})}}}},i)}},{title:this.$t("dt.form.OrderMoney"),width:120,align:"center",render:function(e,n){var i=n.row.salesOrder||{};return e("span","".concat(t.$options.filters.money(i.money)," ").concat(t.$t("dt.base.unit")))}},{title:this.$t("dt.form.CommissionMoney"),key:"money",width:120,align:"center",render:function(e,n){return e("span","".concat(t.$options.filters.money(n.row.money)," ").concat(t.$t("dt.base.unit")))}},{title:this.$t("dt.form.OtherDividend"),width:120,align:"center",render:function(e,n){var i=n.row.money-(n.row.orderMoney+n.row.surpluMoney);return e("span","".concat(t.$options.filters.money(i)," ").concat(t.$t("dt.base.unit")))}},{title:this.$t("dt.form.OrderDividend"),key:"orderMoney",width:120,align:"center",render:function(e,n){return e("span","".concat(t.$options.filters.money(n.row.orderMoney)," ").concat(t.$t("dt.base.unit")))}},{title:this.$t("dt.form.SurpluMoney"),key:"surpluMoney",width:120,align:"center",render:function(e,n){return e("span","".concat(t.$options.filters.money(n.row.surpluMoney)," ").concat(t.$t("dt.base.unit")))}},{title:this.$t("dt.form.CommissionPeopleNumber"),width:100,align:"center",render:function(e,n){var i=n.row.child||[];return e("span","".concat(i.length," ").concat(t.$t("dt.base.people")))}},{title:this.$t("dt.form.ProgramMode"),key:"tye",width:120,align:"center",render:function(e,n){var i="#19be6b";return 2===n.row.tye&&(i="#ed4014"),e("span",{style:{color:i}},t.$options.filters.dividendType(n.row.tye))}},{title:this.$t("dt.form.DividendProgram"),width:150,align:"center",render:function(e,n){var i=n.row.dividend||{};return e(t.$isHasMenuAuth("admin.ProgramDetail")&&!r["a"].isEmpty(i)?"router-link":"span",{props:{to:{name:"admin.ProgramDetail",params:{id:i.id}}}},i.name||t.$t("dt.base.Nothing"))}},{title:this.$t("dt.form.OrderStatus"),key:"status",width:120,align:"center",render:function(e,n){var i={};return 3===n.row.status&&(i.color="#2d8cf0"),e("span",{style:i},t.$options.filters.dividendOrderStatus(n.row.status))}},{title:this.$t("dt.base.remark"),key:"remark",minWidth:200,maxWidth:300,tooltip:!0,align:"center"},{title:this.$t("dt.form.updatedAt"),key:"updatedAt",width:170,align:"center",sortable:!0,render:function(e,n){return e("span",t.$options.filters.formatTime(n.row.updatedAt))}},{title:this.$t("dt.form.createdAt"),key:"createdAt",width:170,align:"center",sortable:!0,render:function(e,n){return e("span",t.$options.filters.formatTime(n.row.createdAt))}},{title:this.$t("dt.form.action"),key:"action",width:180,align:"center",fixed:"right",render:function(e,n){var i=[];return t.$isHasMenuAuth("admin.CommissionEdit")&&2===n.row.status&&i.push(e("Button",{props:{type:"success",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.$Modal.confirm({title:t.$t("dt.toast.tips"),content:"".concat(t.$t("dt.base.whether")).concat(t.$t("dt.form.Billing"),"?"),loading:!0,closable:!0,onOk:function(){t.handlePutPurchase(n.row,{status:3})}})}}},t.$t("dt.form.Billing"))),t.$isHasMenuAuth("admin.CommissionDetail")&&i.push(e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.handleCheckHabitType({name:"admin.CommissionDetail",params:{id:n.row.id}})}}},t.$t("dt.form.detail"))),t.$isHasMenuAuth("admin.CommissionEdit")&&2===n.row.status&&i.push(e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.handleCheckHabitType({name:"admin.CommissionEdit",params:{id:n.row.id}})}}},t.$t("dt.form.edit"))),e("div",i)}}]}},created:function(){this.handleGetMonthCount(),this.handleList()},mounted:function(){window.aa=this},watch:{},filters:{},methods:{handleList:function(){var t=this,e=this.handleInitFields(this.columns,["child.id","child.money","child.user.id","child.user.username","dividend.id","dividend.name","salesOrder.id","salesOrder.money"]),n=this.variables;this.$Http.Post({mutation:this.$Model.DividendOrders,variables:n,fields:e}).then((function(e){var n=e.data;t.formTemp=Object(o["a"])(Object(o["a"])({},t.formTemp),n),t.sortData(t.formTemp.data)}))},sortData:function(){var t=this;r["a"].each(this.formTemp.data,(function(e,n){e.index=(t.formTemp.current_page-1)*t.formTemp.per_page+n+1,e.loading=!1}))},handleCommissionCount:function(t){return this.$Http.Post({mutation:this.$Model.CommissionCount,variables:{month:t}}).then((function(t){return t}))},handleGetMonthCount:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i,s,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.$options.filters.formTimestamp(new Date)-288e5,i=t.$options.filters.formatTime(n,"YYYY,MM,0"),s=i.split(",").map((function(t){return Number(t)})),a=new Date(s[0],s[1],s[2]).getDate(),o=n-864e5*a,t.formTemp.currentMonth=[t.$options.filters.formatTime(n,"YYYYMM")],t.formTemp.lastMonth=[t.$options.filters.formatTime(o,"YYYYMM")];case 7:case"end":return e.stop()}}),e)})))()},handleModalStatusChange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.modalStatus=t,this.dividendCount=!0},handleModalOnVisibleChang:function(t){this.formTemp.month=null,this.dividendCount=t,this.formTemp.orderNumber=0},handleCountMonthChange:function(t){if(t){var e=this.$options.filters.formTimestamp(t)-288e5;this.formTemp.month=this.$options.filters.formatTime(e,"YYYYMM"),1===this.modalStatus?this.handleCountSalesOrder(2):this.handleCountSalesOrder(1)}},handleCountSalesOrder:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=this.handleInitFields([],[],["total"]);this.$Http.Post({mutation:this.$Model.DividendOrders,variables:{filter:{month:this.formTemp.month,status:e}},fields:n}).then((function(e){var n=e.data;t.formTemp.orderNumber=n.total||0}))},handleGenerateCommission:function(){var t=this;1!==this.modalStatus?this.$Http.Post({mutation:this.$Model.GenerateCommission,variables:{month:this.formTemp.month}}).then((function(){t.handleModalOnVisibleChang(!1),t.handleList()})):this.$Modal.confirm({title:this.$t("dt.toast.tips"),content:"".concat(this.$t("dt.base.whether")).concat(this.$t("dt.form.StartSettle"),"?"),loading:!0,closable:!0,onOk:function(){t.$Http.Post({mutation:t.$Model.MonthSettle,variables:{month:t.formTemp.month}}).then((function(){t.$Message.success("".concat(t.$t("dt.form.action")).concat(t.$t("dt.status.success"))),t.$Modal.remove(),t.handleModalOnVisibleChang(!1),t.handleList()}))}})},handlePutPurchase:function(t,e){var n=this,i={id:t.id};for(var s in e)i[s]=e[s];this.handleRowItemSave(i,(function(i){if(!r["a"].isEmpty(i)){for(var s in e)t[s]=e[s];n.$Modal.remove()}}))},handleRowItemSave:function(t,e){r["a"].isEmpty(t)||this.handleOnRecovery({api:this.$Model.DividendOrderEdit,item:t,type:2},e)},handleUpdateStatus:function(t,e){this.handleUpdateStatusFunc({api:this.$Model.DividendOrderEdit,item:t,value:e})},handleRecovery:function(t,e){r["a"].isEmpty(t)||this.handleOnRecovery({api:this.$Model.DividendOrdersRecovery,item:t},e)},handleDelete:function(t){r["a"].isEmpty(t.id)||r["a"].isEmpty(t.index)||this.handleOnDelete({api:this.$Model.DividendOrdersDelete,item:t})}}},$=C,g=(n("4ba9"),Object(p["a"])($,i,s,!1,null,"18479bcd",null));e["default"]=g.exports},a578:function(t,e,n){},c3be:function(t,e,n){},d581:function(t,e,n){"use strict";n("c3be")}}]);