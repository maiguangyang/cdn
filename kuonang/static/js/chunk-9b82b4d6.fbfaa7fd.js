(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9b82b4d6"],{4472:function(e,t,n){},"4ec25":function(e,t,n){"use strict";n("6a61");var r=n("2e91"),a=n("d211"),i=n("5880"),u=n("b8f9"),c={data:function(){return{id:null,isReadonly:!1,formData:{branchId:this.$UserInfo.bid,state:!0,weight:1}}},props:{formData_bak:{type:Object,default:function(){return{}}},formModel:{type:Object,default:function(){return{}}},btnTitle:{type:String,default:""},tabName:{type:Array,default:function(){return[null]}}},created:function(){this.id=this.$GetParamsId(this),this.$FormCheck("*",this.formModel.readonly)&&(this.isReadonly=!0,this.ruleInline={})},computed:Object(a["a"])({},Object(i["mapState"])("base",{loading:function(e){return e.loading},isMethodList:function(e){return e.isMethodList}})),methods:{handleEmitData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.formData;this.$store.commit("popupModel/pageModal",{pageModal:!1}),this.$emit("formDataSubmit",{data:e})},handleFilterBranchChange:function(e){u["a"].isEmpty(e)||(this.formData.branchId=e)},handleSumbit:function(){var e=arguments,t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var a,i,c,s,o,h;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.length>0&&void 0!==e[0]?e[0]:t.formData,i=e.length>1&&void 0!==e[1]?e[1]:"form",a.state=!0===a.state||1*a.state===1?1:2,c=!0,s=!1,!u["a"].isString(i)){n.next=16;break}if(t.$refs[i]){n.next=11;break}c=!1,s=!0,n.next=14;break;case 11:return n.next=13,t.$refs[i].validate((function(e){return e}));case 13:s=n.sent;case 14:n.next=22;break;case 16:if(!u["a"].isArray(i)){n.next=22;break}return o=!0,u["a"].each(i,function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$refs[n]?t.$refs[n].validate((function(e){!1===e&&!0===o&&(o=!1)})):(c=!1,o=!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.next=21,o;case 21:s=n.sent;case 22:if(!1!==c||!0!==s){n.next=25;break}return t.handleEmitData(a),n.abrupt("return");case 25:if(!1!==s){n.next=28;break}return t.$Message.error(t.$t("dt.form.checkFormComplete")),n.abrupt("return");case 28:h=t.$store.state.popupModel.pageModal,!0===h&&t.$store.commit("popupModel/loadData",{loadData:!0}),t.handleEmitData(a);case 31:case"end":return n.stop()}}),n)})))()}}};t["a"]=c},b602:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Row",{staticClass:"auth-group",attrs:{type:"flex",align:"bottom",gutter:20}},[e.$route.name.includes("Auth")||e.$route.name.includes("BranchType")?e._e():n("Col",{staticClass:"input-item",attrs:{xs:24,sm:24,md:8,lg:6,xl:6,xxl:6}},[n("Divider",{attrs:{orientation:"left"}},[e._v(e._s(e.$t("dt.base.menuAuth")))]),n("Tree",{ref:"menuAuth",attrs:{data:e.formTemp.menuAuth,"empty-text":e.$t("dt.toast.MerchantTreeEmptyText"),"show-checkbox":""},on:{"on-check-change":e.handleTreeCheckChange}})],1),e.$route.name.includes("Auth")||e.$route.name.includes("BranchType")?n("Col",{staticClass:"input-item",attrs:{xs:24,sm:24,md:24,lg:24,xl:24,xxl:24}},[n("Divider",{attrs:{orientation:"left"}},[e._v(e._s(e.$t("dt.base.menuAuth")))]),n("Tree",{ref:"menuAuth",attrs:{data:e.formTemp.menuAuth,"empty-text":e.$route.name.includes("Auth")?e.$t("dt.toast.TreeEmptyText"):e.$t("dt.toast.MerchantTreeEmptyText"),"show-checkbox":""},on:{"on-check-change":e.handleTreeCheckChange}})],1):e._e(),2===e.$UserInfo.super&&e.$route.name.includes("admin.MerchantType")?n("Col",{staticClass:"input-item",attrs:{xs:24,sm:24,md:16,lg:18,xl:18,xxl:18}},[n("Divider",{attrs:{orientation:"left"}},[e._v(e._s(e.$t("dt.base.otherAuth")))]),n("Table",{attrs:{border:"","row-class-name":e.rowClassName,columns:e.otherAuth,data:e.formTemp.otherAuth}})],1):e._e()],1)},a=[],i=(n("2d38"),n("2c78"),n("1b8a"),n("9953"),n("8ab6"),n("69bf"),n("64fe"),n("02bf"),n("90d4"),n("5c4c"),n("845c"),n("d8f4"),n("85e2"),n("9151"),n("8dc4"),n("2083"),n("066a"),n("4c09")),u=n("d211"),c=(n("6a61"),n("2e91")),s=n("b8f9"),o=n("4ec25"),h={name:"Authority",mixins:[o["a"]],data:function(){return{flagModel:!1,formTemp:{subMenu:[],currentMenu:[],currentOther:[],menuAuth:[],otherAuth:[]},ApiJson:[]}},props:{readonly:{type:Boolean,default:function(){return!1}},propData:{type:Object,default:function(){return{}}}},computed:{otherAuth:function(){var e=this;return[{title:this.$t("dt.form.name"),key:"title",minWidth:100,align:"center"},{title:this.$t("dt.base.use"),key:"detail",align:"center",render:function(t,n){if(n.row.detail)return t("checkbox",{props:{disabled:!0===e.readonly,value:-1!==e.formTemp.currentOther.indexOf(n.row.detail.name)||1===n.row.default},on:{"on-change":function(t){e.handleColumnChange(t,n.row.detail)}}},"")}}]}},created:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.id=e.$GetParamsId(e),e.id){t.next=6;break}return t.next=4,e.handleMenuList();case 4:n=t.sent,s["a"].isEmpty(n)||(e.formTemp.menuAuth=JSON.parse(JSON.stringify(n)));case 6:e.handleInitFeature();case 7:case"end":return t.stop()}}),t)})))()},mounted:function(){},components:{},watch:{propData:{deep:!0,handler:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.formTemp.currentMenu=e.menu?JSON.parse(e.menu):[],t.formTemp.currentOther=e.feature?e.feature.split(","):[],t.formData=e,n.next=5,t.handleMenuList();case 5:r=n.sent,s["a"].isEmpty(r)||(t.formTemp.menuAuth=JSON.parse(JSON.stringify(r)));case 7:case"end":return n.stop()}}),n)})))()}},"formTemp.currentMenu":function(e,t){this.$md5(JSON.stringify(e))!==this.$md5(JSON.stringify(t))&&this.handleSumbitCheck()},"formTemp.currentOther":function(e,t){this.$md5(JSON.stringify(e))!==this.$md5(JSON.stringify(t))&&this.handleSumbitCheck()}},methods:{handleMerchantType:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$Http.Post({mutation:e.$Model.CommonMerchantDetail,variables:{id:e.$UserInfo.mid},fields:["id","tye.id","tye.value","tye.menu","tye.feature"]}).then((function(e){return e.data}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},handleBranchType:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$Http.Post({mutation:e.$Model.BranchTypeDetail,variables:{filter:{branchs:{id:e.$UserInfo.bid}}},fields:["id","menu","feature"]}).then((function(e){return e.data}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},handleRolesAuths:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$Http.Post({mutation:e.$Model.GetUserRoleAuth}).then((function(e){return e.data}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},handleMenuList:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=[],2!==e.$UserInfo.super||!e.$route.name.includes("admin.MerchantType")){t.next=5;break}n=e.$Session.get("MENUS_ALL").data||[],t.next=42;break;case 5:if(!0!==e.$UserInfo.admin||e.$route.name.includes("admin.Auth")){t.next=26;break}return t.next=8,e.handleMerchantType();case 8:return r=t.sent,t.next=11,r.tye;case 11:if(t.t0=t.sent,t.t0){t.next=14;break}t.t0={};case 14:return a=t.t0,t.prev=15,t.next=18,JSON.parse(a.menu);case 18:n=t.sent,t.next=24;break;case 21:t.prev=21,t.t1=t["catch"](15),n=[];case 24:t.next=42;break;case 26:if(!0!==e.$UserInfo.branchAdmin){t.next=41;break}return t.next=29,e.handleBranchType();case 29:return i=t.sent,t.prev=30,t.next=33,JSON.parse(i.menu);case 33:n=t.sent,t.next=39;break;case 36:t.prev=36,t.t2=t["catch"](30),n=[];case 39:t.next=42;break;case 41:n=e.$Session.get("MENUS_ALL").data||[];case 42:return s["a"].each(n,(function(e){e.checked=!1,2===e.tye&&(e.expand=!1)})),t.next=45,e.$handleFindMenu(n,(function(t){s["a"].each(t,(function(n){n.checked=!1,s["a"].isEmpty(n.title)&&(n.title=n.name),99!==n.tye&&1!==n.tye||(n.expand=!0),!0===e.readonly&&(n.disabled=!0,n.expand=!0);var r=e.formTemp.currentMenu.find((function(e){return e.route===n.route&&e.title===n.title&&e.tye===n.tye}));if(!s["a"].isEmpty(r)&&s["a"].isObject(r)){if(!0===r.route.includes("Edit")){var a=t.find((function(e){return e.tye===r.tye&&e.pid===r.pid&&e.route.includes("Detail")}));s["a"].isEmpty(a)||(a.checked=r.checked,a.disabled=!0)}n.expand=!0,3===n.tye&&(n.checked=r.checked),2===n.tye&&(n.expand=!1,1===n.has&&(n.checked=r.checked))}}))}));case 45:return u=t.sent,setTimeout((function(){e.handleAuthSelectChange()}),500),t.abrupt("return",u);case 48:case"end":return t.stop()}}),t,null,[[15,21],[30,36]])})))()},handleEditRelationDetail:function(e,t){var n=this;if(!s["a"].isEmpty(e)){var r=function r(a){s["a"].each(a,(function(a){if(a.id===e){var i=a.children.findIndex((function(e){return e.route===t.replace("Edit","Detail")}));if(-1!==i){var c=a.children.find((function(e){return e.route===t}))||{},o=a.children[i],h=!0===c.checked;n.$set(a.children,i,Object(u["a"])(Object(u["a"])({},o),{},{checked:!0===o.checked||h,disabled:c.checked||!1}))}}else a.id===e||s["a"].isEmpty(a.children)||r(a.children)}))};r(this.formTemp.menuAuth)}},handleTreeCheckChange:function(e,t){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var r,a,u,c,o,h,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null===t.route&&(t.route=""),!0!==t.route.includes("Edit")){e.next=4;break}return e.next=4,n.handleEditRelationDetail(t.pid,t.route);case 4:r=function e(t){s["a"].each(t.children,(function(n){s["a"].isEmpty(n.children)?(null===n.route&&(n.route=""),n.route.includes("Detail")&&(n.disabled=t.checked)):e(n)}))},r(t),n.$refs.menuAuth&&(a=n.$refs.menuAuth.getCheckedAndIndeterminateNodes(),u=[],c=[],s["a"].each(a,(function(e){if(!s["a"].isEmpty(e.feature)){var t=n.formTemp.currentOther.indexOf(e.feature);-1===t&&c.push(e.feature)}u.push({id:e.id,checked:e.checked,feature:e.feature,route:e.route,title:e.title,name:e.name,icon:e.icon,pid:e.pid,tye:e.tye,has:e.has,weight:e.weight,createdAt:e.createdAt})})),o=[],s["a"].each(n.formTemp.subMenu,(function(e){var t=a.findIndex((function(t){return t.feature===e.feature}));-1!==t&&o.push(e)})),h=[].concat(Object(i["a"])(n.formTemp.currentOther),c),d=[],s["a"].each(h,(function(e){if(-1===d.indexOf(e)){var t=a.findIndex((function(t){return t.feature===e})),n=o.findIndex((function(t){return t.name===e}));-1===t&&-1===n||d.push(e)}})),n.formTemp.subMenu=o,n.formTemp.currentOther=s["a"].uniqBy(d),n.formTemp.currentMenu=u,n.handleMergeSubMenu(),n.handleAuthSelectChange());case 7:case"end":return e.stop()}}),e)})))()},handleInitFeature:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(["adminApi","commonApi"].map(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(r){var a,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n("53c8")("./".concat(r,".js"));case 2:u=t.sent.default,(a=e.ApiJson).push.apply(a,Object(i["a"])(u));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)})))()},handleAuthSelectChange:function(){var e=this;if(this.$refs.menuAuth){var t=[],n=this.$refs.menuAuth.getCheckedAndIndeterminateNodes().filter((function(e){return!s["a"].isEmpty(e.feature)}));s["a"].each(this.ApiJson,(function(n){var r={};1===n.type&&(1===n.default&&-1===e.formTemp.currentOther.indexOf(n.name)&&e.formTemp.currentOther.push(n.name),s["a"].each(n.data,(function(t){var a=e.$options.filters.apiFileType(t.title);r.type=1,r[a]={name:t.api,feature:n.name}})),t.push(Object(u["a"])({title:n.title,name:n.name,default:n.default||0},r)))}));var r=[];s["a"].each(this.formTemp.subMenu,(function(e){var t=n.findIndex((function(t){return t.feature===e.feature}));-1===t&&r.push(e.name)}));var a=[];s["a"].each(this.formTemp.currentOther,(function(e){var t=r.indexOf(e);-1===t&&a.push(e)})),this.formTemp.otherAuth=t,this.formTemp.currentOther=a}},rowClassName:function(e){return s["a"].isEmpty(e.detail)?"table-menu-row":""},handleColumnChange:function(e,t){var n=this.formTemp.subMenu.findIndex((function(e){return e.route===t.route}));-1!==n||s["a"].isEmpty(t.name)||this.formTemp.subMenu.push(t);var r=this.formTemp.currentOther.indexOf(t.name);e&&-1===r?this.formTemp.currentOther.push(t.name):this.formTemp.currentOther.splice(r,1),this.formTemp.currentOther=s["a"].uniqBy(this.formTemp.currentOther),this.handleMergeSubMenu()},handleMergeSubMenu:function(){var e=this;s["a"].each(this.formTemp.subMenu,(function(t){if(!s["a"].isEmpty(t.route)){var n=e.formTemp.currentMenu.findIndex((function(e){return e.route===t.route}));-1===n&&e.formTemp.currentMenu.push({route:t.route})}}))},handleSumbitCheck:function(){var e=Object(u["a"])({},this.formData);e.menu=JSON.stringify(this.formTemp.currentMenu),e.feature=this.formTemp.currentOther.join(),this.$emit("formDataSubmit",e)}}},d=h,m=(n("e93b"),n("c701")),f=Object(m["a"])(d,r,a,!1,null,"06db6329",null);t["a"]=f.exports},e93b:function(e,t,n){"use strict";n("4472")}}]);