(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ca1277c2"],{"104d":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-content-layer"},[a("Tabs",{staticClass:"tabs",attrs:{type:"card"}},[a("TabPane",{attrs:{label:e.tabName[0]}},[a("Form",{ref:"form",staticClass:"form-page",attrs:{"label-position":"right","label-width":e.$device.mobile()?"auto":100,model:e.formData,rules:e.ruleInline}},[a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("orderNo",e.formModel.hide)&&e.id,expression:"!$FormCheck('orderNo', formModel.hide) && id"}],staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",{attrs:{label:e.$t("dt.form.OrderNo"),prop:"orderNo"}},[a("Input",{attrs:{readonly:e.$FormCheck("orderNo",e.formModel.readonly)||e.id,clearable:!e.$FormCheck("orderNo",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.OrderNo")})},model:{value:e.formData.orderNo,callback:function(t){e.$set(e.formData,"orderNo",t)},expression:"formData.orderNo"}})],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("tye",e.formModel.hide),expression:"!$FormCheck('tye', formModel.hide)"}],staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",{attrs:{label:e.$t("dt.form.PutStockType"),prop:"name"}},[a("Select",{attrs:{disabled:e.$FormCheck("tye",e.formModel.readonly),readonly:e.$FormCheck("tye",e.formModel.readonly),placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.PutStockType")})},on:{"on-change":e.handleRevokeProductTypeChange},model:{value:e.formData.tye,callback:function(t){e.$set(e.formData,"tye",t)},expression:"formData.tye"}},e._l(e.$options.filters.putStockType([]),(function(t){return a("Option",{key:t.value,attrs:{disabled:e.$FormCheck("tye",e.formModel.readonly),value:t.value,label:t.label}},[e._v(" "+e._s(t.label)+" ")])})),1)],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("branchId",e.formModel.hide)&&!0===e.$UserInfo.admin,expression:"!$FormCheck('branchId', formModel.hide) && $UserInfo.admin === true"}],staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",{attrs:{label:""+e.$t("dt.form.ParentBranch"),prop:"branchId"}},[a("e-branch",{attrs:{clearable:!1,readonly:void 0!==e.id,disabled:void 0!==e.id,multiple:!1},on:{callback:e.handleFilterBranchChange},model:{value:e.formData.branchId,callback:function(t){e.$set(e.formData,"branchId",t)},expression:"formData.branchId"}}),e.isReadonly||!e.$isHasMenuAuth("admin.BranchAdd")||e.id?e._e():a("span",{staticClass:"no-flex",on:{click:function(t){e.handleCheckHabitType({name:"admin.BranchAdd",query:{dt:e.$SetDtLink(e.$route,e.$store.state)}})}}},[e._v(" "+e._s(e.$t("dt.form.add"))+" ")])],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("remark",e.formModel.hide),expression:"!$FormCheck('remark', formModel.hide)"}],staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",{attrs:{label:e.$t("dt.base.remark"),prop:"remark"}},[a("Input",{attrs:{readonly:e.$FormCheck("remark",e.formModel.readonly),clearable:!e.$FormCheck("remark",e.formModel.readonly),maxlength:"255","show-word-limit":"",type:"textarea",rows:4,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.base.remark")})},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:!e.$FormCheck("purchaseId",e.formModel.hide),expression:"!$FormCheck('purchaseId', formModel.hide)"}],staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[4===e.formData.tye?a("FormItem",{attrs:{label:e.$t("dt.form.ProductList"),prop:"revokeProductId"}},[a("ListSelectModal",{ref:"ProductSkus",attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.ProductList")}),api:e.$Model.ProductSkus,showList:!1,readonly:e.isReadonly,column:[{product:{name:e.$t("dt.form.ProductName")}},{label:e.$t("dt.form.SkuName")},{skuCode:e.$t("dt.form.SkuCode")}],merge:["product.productCode","product.productBarCode"],attrs:{label:"label",value:"id"},filter:e.filter,callback:e.handleProductListFunc,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.ProductName")})},model:{value:e.formTemp.product,callback:function(t){e.$set(e.formTemp,"product",t)},expression:"formTemp.product"}},[a("div",{staticClass:"filter-layer-group",attrs:{slot:"filter"},slot:"filter"},[a("div",{staticClass:"filter-item"},[a("span",[e._v(e._s(e.$t("dt.form.ProductName"))+"：")]),a("Input",{attrs:{search:"","enter-button":"",placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.ProductName")})},on:{"on-enter":e.handleFilterProductChange,"on-search":e.handleFilterProductChange},model:{value:e.filter.product.name_like,callback:function(t){e.$set(e.filter.product,"name_like",t)},expression:"filter.product.name_like"}})],1),a("div",{staticClass:"filter-item"},[a("span",[e._v(e._s(e.$t("dt.form.SkuCode"))+"：")]),a("Input",{attrs:{search:"","enter-button":"",placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.SkuCode")})},on:{"on-enter":e.handleFilterSkuCodeChange,"on-search":e.handleFilterSkuCodeChange},model:{value:e.filter.skuCode_like,callback:function(t){e.$set(e.filter,"skuCode_like",t)},expression:"filter.skuCode_like"}})],1)])])],1):3===e.formData.tye?a("FormItem",{attrs:{label:e.$t("dt.form.RevokeProductOrder"),prop:"revokeProductId"}},[a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.RevokeProductOrder")}),route:"RevokeProductAdd",readonly:e.$FormCheck("revokeProductId",e.formModel.readonly),api:e.$Model.PurchaseRevokeProducts,column:[{orderNo:e.$t("dt.form.RevokeProductOrder")},{number:e.$t("dt.form.RevokeProductNumber"),width:100},{putNumber:e.$t("dt.form.PutNumber"),width:100},{remark:e.$t("dt.base.remark")}],merge:["detail.id","detail.number","detail.putNumber","detail.sku.id","detail.sku.label","detail.sku.skuPicture","detail.sku.product.id","detail.sku.product.name"],attrs:{label:"orderNo",value:"id"},filter:{tye:2,status:3,isPut:1},callback:e.handleRevokeProductOrderFunc,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.RevokeProductOrder")})},model:{value:e.formData.revokeProductId,callback:function(t){e.$set(e.formData,"revokeProductId",t)},expression:"formData.revokeProductId"}})],1):a("FormItem",{attrs:{label:e.$t("dt.form.PurchaseOrder"),prop:"purchaseId"}},[2===e.formData.tye?a("span",[e._v(e._s(e.$t("dt.form.ProductAllocation")))]):e._e(),a("ListSelectModal",{attrs:{title:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.PurchaseOrder")}),route:"ProductAdd",readonly:e.$FormCheck("purchaseId",e.formModel.readonly),api:e.$Model.PurchaseOrders,column:[{name:e.$t("dt.form.PurchaseOrder")},{number:e.$t("dt.form.PurchaseNumber")},{putNumber:e.$t("dt.form.PutNumber")},{revokeNumber:e.$t("dt.form.RevokeProductNumber")},{remark:e.$t("dt.base.remark")}],merge:["supply.id","supply.name","supply.code","detail.id","detail.skuId","detail.productId","detail.label","detail.name","detail.number","detail.skuPicture","detail.revokeNumber","detail.putStock.id","detail.putStock.number"],attrs:{label:"name",value:"id"},filter:{status_in:[2,3],isPut:1},callback:e.handleOrderDataFunc,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.PurchaseOrder")})},model:{value:e.formData.purchaseId,callback:function(t){e.$set(e.formData,"purchaseId",t)},expression:"formData.purchaseId"}})],1)],1),a("Col",{directives:[{name:"show",rawName:"v-show",value:e.formTemp.data.length>0,expression:"formTemp.data.length > 0"}],staticClass:"input-item",attrs:{xs:24,sm:24,md:24,lg:24,xl:22,xxl:22}},[a("FormItem",[a("div",[a("Tag",{directives:[{name:"show",rawName:"v-show",value:!e.isReadonly,expression:"!isReadonly"}]},[e._v(e._s(e.$t("dt.toast.SelectPutStockProduct")))]),1===e.formData.tye?a("Table",{ref:"selection",staticClass:"table-body",attrs:{border:"",loading:e.loading&&e.isMethodList,"max-height":500,columns:e.columns,"span-method":e.handleSpan,data:e.formTemp.data},on:{"on-select-cancel":e.handleTableOnSelectCancel,"on-selection-change":e.handleTableSelectionChange}}):e._e(),3===e.formData.tye?a("Table",{ref:"selection",staticClass:"table-body",attrs:{border:"",loading:e.loading&&e.isMethodList,"max-height":500,columns:e.columns,"span-method":e.handleSpan,data:e.formTemp.data},on:{"on-select-cancel":e.handleTableOnSelectCancel,"on-selection-change":e.handleTableSelectionChange}}):e._e(),4===e.formData.tye?a("Table",{ref:"selection",staticClass:"table-body",attrs:{border:"",loading:e.loading&&e.isMethodList,"max-height":500,columns:e.directColumns,"span-method":e.handleSpan,data:e.formTemp.data}}):e._e()],1)])],1),a("Col",{staticClass:"input-item",attrs:{xs:24,sm:16,md:16,lg:12,xl:8,xxl:6}},[a("FormItem",[!e.isReadonly&&e.$isHasMenuAuth("admin.PutStockAdd")||!e.isReadonly&&e.$isHasMenuAuth("admin.PutStockEdit")?a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleSumbitCheck}},[e._v(" "+e._s(e.$t("dt.form.ConfirmPutStock"))+" ")]):e.$isHasMenuAuth("admin.PutStockEdit")&&1===e.formData.status?a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.handleCheckHabitType({name:"admin.PutStockEdit",params:{id:e.id}})}}},[e._v(" "+e._s(e.$t("dt.form.edit"))+" ")]):e._e(),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleRouteGoBack("admin.PutStockList")}}},[e._v(e._s(e.$t("dt.base.back")))])],1)],1)],1)],1)],1)],1)},o=[],n=(a("2d38"),a("2c78"),a("1b8a"),a("9953"),a("69bf"),a("02bf"),a("a39b"),a("90d4"),a("5c4c"),a("d211")),i=a("b8f9"),d=a("4ec25"),l=a("6b9c"),s=a("494e"),c={name:"PutStockModel",mixins:[d["a"]],data:function(){var e=this;return{currentProduct:[],currentOrder:{},tableMultipleSelect:[],filter:{product:{}},formTemp:{data:[],oldData:[],product:[],productList:[],warehouseList:[],locationsList:[],articlesList:[],allocation:[]},formData:{tye:4,userId:this.$UserInfo.id,purchaseId:null,revokeProductId:null},directColumns:[{title:this.$t("dt.form.action"),key:"action",width:80,align:"center",render:function(t,a){return t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.formTemp.data.splice(a.index,1)}}},e.$t("dt.form.delete"))}},{title:this.$t("dt.form.Product"),oldTitle:this.$t("dt.form.Product"),align:"center",children:[{title:this.$t("dt.form.name"),key:"label",minWidth:200,align:"center"},{title:this.$t("dt.form.Spec"),key:"name",minWidth:200,align:"center",render:function(t,a){return t("span",a.row.name||e.$t("dt.base.Nothing"))}},{title:this.$t("dt.form.BarCode"),key:"skuCode",minWidth:160,align:"center",render:function(t,a){var r=a.row.product||{};return t("span",r.productBarCode||e.$t("dt.base.Nothing"))}},{title:this.$t("dt.form.ProductCode"),key:"productCode",minWidth:120,align:"center",render:function(t,a){var r=a.row.product||{};return t("span",r.productCode||e.$t("dt.base.Nothing"))}},{title:this.$t("dt.form.SkuCode"),key:"skuCode",minWidth:120,align:"center",render:function(t,a){return t("span",a.row.skuCode||e.$t("dt.base.Nothing"))}}]},{title:this.$t("dt.form.PutStockInfo"),align:"center",children:[{title:this.$t("dt.form.Warehouse"),minWidth:150,align:"center",renderHeader:function(t,a){var r=a.column;return t("div",[t("span",r.title),t("e-dropdown",{props:{columnKey:r.key,name:"name",value:"id",dataList:e.formTemp.warehouseList},on:{handleDropdownChange:function(t){var a=e.formTemp.warehouseList.find((function(e){return e.id===t.data}))||{};e.formTemp.locationsList=a.location||[],i["a"].each(e.formTemp.data,(function(e){var t=a.sku.find((function(t){return t.warehouseId===a.id&&t.skuId===e.skuId}))||{};e.locationId=null,e.articleIds=[];var r=a.location.find((function(e){return e.id===t.locationId}))||{};e.skuId===t.skuId&&(e.locationId=t.locationId,e.articleIds=t.articleIds,e.articles=r.article||[]),i["a"].each(a.location,(function(t){t.disabled=!1,!i["a"].isEmpty(r)&&e.locationId&&t.id!==e.locationId&&(t.disabled=!0)})),e.warehouse=a,e.warehouseId=a.id,e.locations=a.location||[]}))}}})])},render:function(t,a){return t("div",[t("e-select",{props:{open:!0,disabled:e.isReadonly,current:a.row.warehouseId,name:"name",value:"id",dataList:e.formTemp.warehouseList},on:{handleSelectChange:function(t){var r=e.formTemp.data[a.index],o=e.formTemp.warehouseList.find((function(e){return e.id===t}))||{},n=o.sku.find((function(e){return e.warehouseId===o.id&&e.skuId===r.skuId}))||{};r.locationId=null,r.articleIds=[];var d=o.location.find((function(e){return e.id===n.locationId}))||{};r.skuId===n.skuId&&(r.locationId=n.locationId,r.articleIds=n.articleIds,r.articles=d.article||[]),i["a"].each(o.location,(function(e){e.disabled=!1,!i["a"].isEmpty(d)&&r.locationId&&e.id!==r.locationId&&(e.disabled=!0)})),r.warehouse=o,r.warehouseId=t,r.locations=o.location||[]}}})])}},{title:this.$t("dt.form.Location"),key:"locationId",minWidth:150,align:"center",renderHeader:function(t,a){var r=a.column;return t("div",[t("span",r.title),t("e-dropdown",{props:{columnKey:r.key,name:"name",value:"id",dataList:e.formTemp.locationsList},on:{handleDropdownChange:function(t){var a=e.formTemp.locationsList.find((function(e){return e.id===t.data}))||{};e.formTemp.articlesList=a.article||[],i["a"].each(e.formTemp.data,(function(e){e.locationId=a.id,e.articleIds=[],e.articles=a.article||[]}))}}})])},render:function(t,a){return i["a"].isEmpty(a.row.warehouseId)?t("span",e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.Warehouse")})):t("div",[t("e-select",{props:{open:!0,disabled:e.isReadonly,current:a.row.locationId,name:"name",value:"id",dataList:a.row.locations},on:{handleSelectChange:function(t){var r=e.formTemp.warehouseList.find((function(e){return e.id===a.row.warehouseId}))||{},o=r.location.find((function(e){return e.id===t}))||{},n=r.sku.find((function(e){return e.warehouseId===r.id}))||{};e.formTemp.data[a.index].articleIds=[],e.formTemp.data[a.index].skuId===n.skuId&&o.article.length>0&&(e.formTemp.data[a.index].articleIds=n.articleIds),e.formTemp.data[a.index].articles=o.article||[],e.formTemp.data[a.index].locationId=t}}})])}},{title:this.$t("dt.form.ArticleNo"),key:"articleIds",minWidth:150,align:"center",renderHeader:function(t,a){var r=a.column;return t("div",[t("span",r.title),t("e-dropdown",{props:{columnKey:r.key,name:"name",value:"id",dataList:e.formTemp.articlesList},on:{handleDropdownChange:function(t){var a=e.formTemp.articlesList.find((function(e){return e.id===t.data}))||{};i["a"].each(e.formTemp.data,(function(e){e.articleIds=[a.id]}))}}})])},render:function(t,a){return i["a"].isEmpty(a.row.locationId)?t("span",e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.Location")})):t("div",[t("e-select",{props:{open:!0,multiple:!0,disabled:e.isReadonly,current:a.row.articleIds,name:"name",value:"id",dataList:a.row.articles},on:{handleSelectChange:function(t){e.formTemp.data[a.index].articleIds=t}}})])}}]},{title:this.$t("dt.form.PutStockNumber"),key:"number",width:120,align:"center",fixed:this.$device.mobile()?"":"right",renderHeader:function(t,a){var r=a.column;return e.isReadonly?t("span",r.title):t("div",[t("span",r.title),t("e-input",{props:{title:e.$t("dt.form.batch"),open:!0,isIntType:!0,columnKey:r.key},on:{handleDropdownInput:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i["a"].each(e.formTemp.data,(function(e){e.number=t.data||0}))}}})])},render:function(t,a){var r=a.row.number;if(e.id){var o=[t("span",r)];return o}return t("InputNumber",{props:{value:r,size:"small",min:0,clearable:!0,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.PutStockNumber")})},on:{input:function(t){e.formTemp.data[a.index].number=t}}},r)}}],columns:[{type:"selection",width:60,align:"center",fixed:this.$device.mobile()?"":"left"},{title:this.$t("dt.form.index"),type:"index",width:80,align:"center"},{title:this.$t("dt.form.Product"),oldTitle:this.$t("dt.form.Product"),align:"center",children:[{title:this.$t("dt.form.name"),key:"label",minWidth:200,align:"center"},{title:this.$t("dt.form.Spec"),key:"name",minWidth:200,align:"center",render:function(t,a){return t("span",a.row.name||e.$t("dt.base.Nothing"))}}]},{title:this.$t("dt.form.PutStockInfo"),align:"center",children:[{title:this.$t("dt.form.Warehouse"),minWidth:150,align:"center",renderHeader:function(t,a){var r=a.column;return t("div",[t("span",r.title),t("e-dropdown",{props:{columnKey:r.key,name:"name",value:"id",dataList:e.formTemp.warehouseList},on:{handleDropdownChange:function(t){var a=e.formTemp.warehouseList.find((function(e){return e.id===t.data}))||{};e.formTemp.locationsList=a.location||[],i["a"].each(e.formTemp.data,(function(e){var t=a.sku.find((function(t){return t.warehouseId===a.id&&t.skuId===e.skuId}))||{};e.locationId=null,e.articleIds=[];var r=a.location.find((function(e){return e.id===t.locationId}))||{};e.skuId===t.skuId&&(e.locationId=t.locationId,e.articleIds=t.articleIds,e.articles=r.article||[]),i["a"].each(a.location,(function(t){t.disabled=!1,!i["a"].isEmpty(r)&&e.locationId&&t.id!==e.locationId&&(t.disabled=!0)})),e.warehouse=a,e.warehouseId=a.id,e.locations=a.location||[]}))}}})])},render:function(t,a){return t("div",[t("e-select",{props:{open:!0,disabled:e.isReadonly,current:a.row.warehouseId,name:"name",value:"id",dataList:e.formTemp.warehouseList},on:{handleSelectChange:function(t){var r=e.formTemp.data[a.index],o=e.formTemp.warehouseList.find((function(e){return e.id===t}))||{},n=o.sku.find((function(e){return e.warehouseId===o.id&&e.skuId===r.skuId}))||{};r.locationId=null,r.articleIds=[];var d=o.location.find((function(e){return e.id===n.locationId}))||{};r.skuId===n.skuId&&(r.locationId=n.locationId,r.articleIds=n.articleIds,r.articles=d.article||[]),i["a"].each(o.location,(function(e){e.disabled=!1,!i["a"].isEmpty(d)&&r.locationId&&e.id!==r.locationId&&(e.disabled=!0)})),r.warehouse=o,r.warehouseId=t,r.locations=o.location||[]}}})])}},{title:this.$t("dt.form.Location"),key:"locationId",minWidth:150,align:"center",renderHeader:function(t,a){var r=a.column;return t("div",[t("span",r.title),t("e-dropdown",{props:{columnKey:r.key,name:"name",value:"id",dataList:e.formTemp.locationsList},on:{handleDropdownChange:function(t){var a=e.formTemp.locationsList.find((function(e){return e.id===t.data}))||{};e.formTemp.articlesList=a.article||[],i["a"].each(e.formTemp.data,(function(e){e.locationId=a.id,e.articleIds=[],e.articles=a.article||[]}))}}})])},render:function(t,a){return i["a"].isEmpty(a.row.warehouseId)?t("span",e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.Warehouse")})):t("div",[t("e-select",{props:{open:!0,disabled:e.isReadonly,current:a.row.locationId,name:"name",value:"id",dataList:a.row.locations},on:{handleSelectChange:function(t){var r=e.formTemp.warehouseList.find((function(e){return e.id===a.row.warehouseId}))||{},o=r.location.find((function(e){return e.id===t}))||{},n=r.sku.find((function(e){return e.warehouseId===r.id}))||{};e.formTemp.data[a.index].articleIds=[],e.formTemp.data[a.index].skuId===n.skuId&&o.article.length>0&&(e.formTemp.data[a.index].articleIds=n.articleIds),e.formTemp.data[a.index].articles=o.article||[],e.formTemp.data[a.index].locationId=t}}})])}},{title:this.$t("dt.form.ArticleNo"),key:"articleIds",minWidth:150,align:"center",renderHeader:function(t,a){var r=a.column;return t("div",[t("span",r.title),t("e-dropdown",{props:{columnKey:r.key,name:"name",value:"id",dataList:e.formTemp.articlesList},on:{handleDropdownChange:function(t){var a=e.formTemp.articlesList.find((function(e){return e.id===t.data}))||{};i["a"].each(e.formTemp.data,(function(e){e.articleIds=[a.id]}))}}})])},render:function(t,a){return i["a"].isEmpty(a.row.locationId)?t("span",e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.Location")})):t("div",[t("e-select",{props:{open:!0,multiple:!0,disabled:e.isReadonly,current:a.row.articleIds,name:"name",value:"id",dataList:a.row.articles},on:{handleSelectChange:function(t){e.formTemp.data[a.index].articleIds=t}}})])}}]},{title:this.$t("dt.form.SkuPicture"),key:"skuPicture",minWidth:100,align:"center",render:function(t,a){var r=t("Avatar",{props:{shape:"square",icon:"ios-images"}});return i["a"].isEmpty(e.formTemp.data[a.index][a.column.key])||(r=t("Avatar",{props:{shape:"square",src:e.$options.filters.formatImage(e.formTemp.data[a.index][a.column.key])}})),r}},{title:this.$t("dt.form.SupplyCode"),key:"code",width:120,align:"center",renderHeader:function(t,a){var r=a.column;return e.formTemp.data.length<=0?t("span",r.title):t("div",[t("span",r.title),t("Tooltip",{props:{transfer:!0,placement:"top",maxWidth:"205",content:e.$t("dt.toast.GoodsSignSupplyCode")}},[t("Icon",{props:{size:"16",color:"#f90",type:"ios-alert-outline"}})])])}},{title:this.$t("dt.form.PurchaseNumber"),key:"purchaseNumber",width:100,align:"center"},{title:this.$t("dt.form.PutNumber"),key:"putNumber",width:100,align:"center"},{title:this.$t("dt.form.RevokeProductNumber"),key:"revokeNumber",width:120,align:"center"},{title:this.$t("dt.form.NotPutStock"),key:"notPutStock",width:120,align:"center",fixed:this.$device.mobile()?"":"right"},{title:this.$t("dt.form.PutStockNumber"),key:"number",width:120,align:"center",fixed:this.$device.mobile()?"":"right",renderHeader:function(t,a){var r=a.column;return t("div",[t("span",r.title),t("span",{style:{marginLeft:"5px",backgroundColor:"#ecf5ff",color:"#409EFF",cursor:"pointer",display:e.tableMultipleSelect.length>0?"inline-block":"none"},on:{click:function(){e.handleBatchAllMoney()}}},e.$t("dt.base.All"))])},render:function(t,a){var r=a.row.number;if(e.id){var o=[t("span",r)];return o}return t("InputNumber",{props:{value:r,size:"small",min:0,max:a.row.notPutStock,clearable:!0,readonly:e.isReadonly,placeholder:e.$t("dt.base.pleaseInput",{label:e.$t("dt.form.PutStockNumber")})},on:{input:function(t){e.handleCheckMoney(t,a.index,a.column.key)}}},r)}}],ruleInline:{tye:[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.RevokeProductType")}),trigger:"blur"}],branchId:[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.ParentBranch")}),trigger:"blur"}],purchaseId:[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.PurchaseOrder")}),trigger:"blur"}]}}},computed:{},created:function(){var e=this.$route.query||{};1*e.type===2&&(this.formData.tye=3,this.handleRevokeProductTypeChange(this.formData.tye)),this.handleWarehouseList(),i["a"].isEmpty(this.id)||(this.columns.splice(7,2),this.columns.splice(0,1),this.handleDetail())},mounted:function(){window.aa=this},destroyed:function(){this.$apollo.getClient().cache.reset()},components:{EBranch:l["a"],ListSelectModal:s["a"]},watch:{},methods:{handleDetail:function(){var e=this;this.$Http.Post({mutation:this.$Model.PurchasePutStockDetail,variables:{id:this.id},fields:["id","orderNo","tye","branchId","remark","weight","state","purchaseId","supplyId","userId","detail.id","detail.number","detail.skuId","detail.warehouseId","detail.locationId","detail.articleIds","detail.supply.id","detail.supply.code","detail.sku.id","detail.sku.label","detail.sku.skuCode","detail.sku.skuPicture","detail.sku.product.id","detail.sku.product.name","detail.sku.product.productBarCode","detail.sku.product.productCode","detail.productDetail.id","detail.productDetail.number","detail.revokeProductDetail.id","detail.revokeProductDetail.number"]},(function(){e.$router.push({name:"admin.PutStockList"})})).then((function(t){var a=t.data;a.state=1===a.state||!0===a.state,2===a.tye&&e.columns.splice(5,1);var r=a.detail;e.formTemp.allocation=a.detail;var o=[];i["a"].each(r,(function(t,r){var n=e.formTemp.warehouseList.find((function(e){return e.id===t.warehouseId}))||{},i=n.location||[],d=i.find((function(e){return e.id===t.locationId}))||{},l=d.article||[],s=t.productDetail||{},c=t.revokeProductDetail||{},u=t.supply||{},m=s.number;3===a.tye&&(m=c.number,e.isReadonly&&(e.columns[5].title=e.$t("dt.base.RevokeProductNumber")));var h=t.sku||{},p=h.product||{};o.push({index:r+1,id:t.id,code:u.code||e.$t("dt.base.Nothing"),number:t.number,skuId:t.skuId,warehouseId:t.warehouseId,locationId:t.locationId,articleIds:t.articleIds,label:p.name,name:h.label,skuPicture:h.skuPicture,skuCode:h.skuCode,product:h.product||{},purchaseNumber:m,locations:i,articles:l})})),e.formTemp.data=o,e.formData=Object(n["a"])(Object(n["a"])({},e.formData),a)}))},handleWarehouseList:function(){var e=this;this.$isHasMenuAuth("admin.WarehouseList")&&this.$Http.Post({mutation:this.$Model.Warehouses,variables:{perPage:0},fields:[{data:["id","name","location.id","location.name","location.article.id","location.article.name","sku.id","sku.warehouseId","sku.locationId","sku.articleIds","sku.skuId"]}]}).then((function(t){var a=t.data;e.formTemp.warehouseList=a.data}))},handleProductListFunc:function(e){var t=[];i["a"].each(e,(function(e){t.push({skuId:e.id,label:e.product.name,name:e.label,skuCode:e.skuCode,product:e.product||{},number:0,locations:[],articles:[],warehouseId:null,locationId:null,articleIds:null})})),this.formTemp.data=t,console.log(e)},handleOrderDataFunc:function(e){var t=[];if(this.currentOrder={},!i["a"].isEmpty(e)){var a=e[0],r=a.supply||{};this.currentOrder=a,i["a"].each(a.detail,(function(e){var a=0,o=e.putStock;i["a"].isEmpty(o)||(a=o.map((function(e){return e.number})).reduce((function(e,t){return e+t}),0));var n={productId:e.productId,skuId:e.skuId,label:e.label,name:e.name,code:r.code,skuPicture:e.skuPicture,purchaseNumber:e.number,revokeNumber:e.revokeNumber,putNumber:a,notPutStock:e.number-a-e.revokeNumber||0,number:0,productDetailId:e.id,locations:[],articles:[],warehouseId:null,locationId:null,articleIds:null};n.notPutStock<=0&&(n._disabled=!0),t.push(n)}))}this.formTemp.data=t},handleRevokeProductOrderFunc:function(e){var t=this,a=[];if(this.currentOrder={},!i["a"].isEmpty(e)){var r=e[0];r.supply={},this.currentOrder=r,i["a"].each(r.detail,(function(e){var r=e.sku||{},o={productId:r.product.id,skuId:r.id,label:r.product.name,name:r.label,code:t.$t("dt.base.Nothing"),skuPicture:r.skuPicture,purchaseNumber:e.number,putNumber:e.putNumber,revokeNumber:e.number,notPutStock:e.number-e.putNumber,productDetailId:e.id,number:0,locations:[],articles:[],warehouseId:null,locationId:null,articleIds:null};o.notPutStock<=0&&(o._disabled=!0),a.push(o)}))}this.formTemp.data=a},handleRevokeProductTypeChange:function(e){this.formData.purchaseId=null,this.formData.revokeProductId=null,this.formTemp.data=[],this.formTemp.product=[],1===e?(delete this.ruleInline.revokeProductId,this.ruleInline.purchaseId=[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.PurchaseOrder")}),trigger:"blur"}],this.columns[6].title=this.$t("dt.form.PurchaseNumber"),this.columns[7].title=this.$t("dt.form.RevokeProductNumber")):3===e&&(delete this.ruleInline.purchaseId,this.ruleInline.revokeProductId=[{required:!0,message:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.RevokeProductOrder")}),trigger:"blur"}],this.columns[6].title=this.$t("dt.form.RevokeProductNumber"),this.columns[7].title=this.$t("dt.form.PutNumber"))},handleCheckMoney:function(e,t,a){var r=this.$refs.selection.getSelection().filter((function(e){return e.notPutStock>0}));i["a"].each(this.formTemp.data,(function(e){var t=r.findIndex((function(t){return t.skuId===e.skuId}));-1===t&&(e._checked=!1)})),"number"===a&&e>this.formTemp.data[t].notPutStock?this.$Message.warning(this.$t("dt.api.RevokeNumberNotMaxPutStock")):(this.formTemp.data[t][a]=e,this.formTemp.data[t].money=this.formTemp.data[t].number*this.formTemp.data[t].unitPrice,this.formTemp.data[t].number>0?this.formTemp.data[t]._checked=!0:this.formTemp.data[t]._checked=!1,this.tableMultipleSelect=this.formTemp.data.filter((function(e){return!0===e._checked})))},handleBatchAllMoney:function(){var e=this.$refs.selection.getSelection().filter((function(e){return e.notPutStock>0}));i["a"].each(this.formTemp.data,(function(t){var a=e.findIndex((function(e){return e.productDetailId===t.productDetailId}));-1!==a?t.number=t.notPutStock:t._checked=!1}))},handleTableOnSelectCancel:function(e,t){this.handleTableRowCancelChecked(t)},handleTableRowCancelChecked:function(e){if(!i["a"].isEmpty(e)){var t=this.formTemp.data.findIndex((function(t){return t.productDetailId===e.productDetailId}));-1!==t&&this.$set(this.formTemp.data,t,Object(n["a"])(Object(n["a"])({},this.formTemp.data[t]),{},{_checked:!1}));var a=this.formTemp.data.filter((function(e){return!0===e._checked}));this.tableMultipleSelect=a}},handleTableSelectionChange:function(e){var t=this;this.tableMultipleSelect=e,i["a"].each(this.formTemp.data,(function(a,r){var o=e.findIndex((function(e){return e.productDetailId===a.productDetailId}));-1!==o?a._checked=!0:t.$set(t.formTemp.data,r,Object(n["a"])(Object(n["a"])({},t.formTemp.data[r]),{},{_checked:!1}))}))},handleSpan:function(e){var t=e.row,a=e.column,r=e.rowIndex;if(-1===this.currentProduct.map((function(e){return e.label})).indexOf(t[a.key]))return[1,1];var o=t[a.key];if(r>0&&o===this.formTemp.data[r-1][a.key])return[0,0];for(var n=[1,1],i=r+1;i<this.formTemp.data.length&&o===this.formTemp.data[i][a.key];i++)++n[0];return n},handleFilterProductChange:function(){this.filter.product.name_like||delete this.filter.product.name_like,this.$refs.ProductSkus.handleSlotWatch()},handleFilterSkuCodeChange:function(){this.filter.product.name_like||delete this.filter.product.name_like,this.$refs.ProductSkus.handleSlotWatch()},handleSumbitCheck:function(){var e=this,t=Object(n["a"])({},this.formData);if(i["a"].isEmpty(this.currentOrder)&&4!==t.tye)this.$Notice.warning({title:this.$t("dt.toast.tips"),desc:"".concat(this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.PurchaseOrder")}))});else{var a=this.currentOrder.supply||{};t.supplyId=a.id;var r=!1,o=[];i["a"].each(this.formTemp.data,(function(a){var n=e.tableMultipleSelect.findIndex((function(e){return e.productDetailId===a.productDetailId}));if(-1!==n&&a.number>0||4===t.tye&&a.number>0){i["a"].isEmpty(a.warehouseId)&&(r=!0);var d={skuId:a.skuId,number:a.number,supplyId:t.supplyId,warehouseId:a.warehouseId,locationId:a.locationId,articleIds:a.articleIds,productDetailId:a.productDetailId,branchId:t.branchId};3===t.tye&&(d.revokeProductDetailId=a.productDetailId,delete d.productDetailId),o.push(d)}})),i["a"].isEmpty(o)?this.$Notice.warning({title:this.$t("dt.toast.tips"),desc:"".concat(this.$t("dt.form.PutStockProject")).concat(this.$t("dt.api.notEmpty"))}):!0!==r?(t.detail=o,this.handleSumbit(t)):this.$Notice.warning({title:this.$t("dt.toast.tips"),desc:this.$t("dt.base.pleaseSelect",{label:this.$t("dt.form.Warehouse")})})}}}},u=c,m=(a("ab1e"),a("c701")),h=Object(m["a"])(u,r,o,!1,null,"67a40f54",null);t["a"]=h.exports},"4ec25":function(e,t,a){"use strict";a("6a61");var r=a("2e91"),o=a("d211"),n=a("5880"),i=a("b8f9"),d={data:function(){return{id:null,isReadonly:!1,formData:{branchId:this.$UserInfo.bid,state:!0,weight:1}}},props:{formData_bak:{type:Object,default:function(){return{}}},formModel:{type:Object,default:function(){return{}}},btnTitle:{type:String,default:""},tabName:{type:Array,default:function(){return[null]}}},created:function(){this.id=this.$GetParamsId(this),this.$FormCheck("*",this.formModel.readonly)&&(this.isReadonly=!0,this.ruleInline={})},computed:Object(o["a"])({},Object(n["mapState"])("base",{loading:function(e){return e.loading},isMethodList:function(e){return e.isMethodList}})),methods:{handleEmitData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.formData;this.$store.commit("popupModel/pageModal",{pageModal:!1}),this.$emit("formDataSubmit",{data:e})},handleFilterBranchChange:function(e){i["a"].isEmpty(e)||(this.formData.branchId=e)},handleSumbit:function(){var e=arguments,t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var o,n,d,l,s,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=e.length>0&&void 0!==e[0]?e[0]:t.formData,n=e.length>1&&void 0!==e[1]?e[1]:"form",o.state=!0===o.state||1*o.state===1?1:2,d=!0,l=!1,!i["a"].isString(n)){a.next=16;break}if(t.$refs[n]){a.next=11;break}d=!1,l=!0,a.next=14;break;case 11:return a.next=13,t.$refs[n].validate((function(e){return e}));case 13:l=a.sent;case 14:a.next=22;break;case 16:if(!i["a"].isArray(n)){a.next=22;break}return s=!0,i["a"].each(n,function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$refs[a]?t.$refs[a].validate((function(e){!1===e&&!0===s&&(s=!1)})):(d=!1,s=!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.next=21,s;case 21:l=a.sent;case 22:if(!1!==d||!0!==l){a.next=25;break}return t.handleEmitData(o),a.abrupt("return");case 25:if(!1!==l){a.next=28;break}return t.$Message.error(t.$t("dt.form.checkFormComplete")),a.abrupt("return");case 28:c=t.$store.state.popupModel.pageModal,!0===c&&t.$store.commit("popupModel/loadData",{loadData:!0}),t.handleEmitData(o);case 31:case"end":return a.stop()}}),a)})))()}}};t["a"]=d},"6b9c":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Select",{attrs:{clearable:e.clearable,multiple:e.multiple,disabled:e.disabled,readonly:e.readonly,placeholder:e.$t("dt.base.pleaseSelect",{label:e.$t("dt.form.ParentBranch")})},on:{"on-change":e.handleFilterChange},model:{value:e.branchId,callback:function(t){e.branchId=t},expression:"branchId"}},e._l(e.formTemp.data,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)},o=[],n=(a("422c"),a("1f90"),a("4c09")),i=(a("6a61"),a("2e91")),d=a("b8f9"),l={name:"Address",data:function(){return{branchId:null,formTemp:{data:[]}}},props:{clearable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},value:null,callback:null},computed:{},created:function(){this.$isHasMenuAuth("admin.BranchList")&&this.handleBranchList()},mounted:function(){this.branchId=this.value},watch:{},methods:{handleBranchTypeList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$Http.Post({mutation:e.$Model.BranchTypes,variables:{perPage:0,filter:{userId:e.$UserInfo.id}},fields:[{data:["id","branchs.id","branchs.name"]}]}).then((function(e){var t=e.data||{},a=[];return t.data.forEach((function(e){var t;return(t=a).push.apply(t,Object(n["a"])(e.branchs))})),a=d["a"].uniqBy(a,"id"),{data:a}}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},handleBranchList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=[],2!==e.$UserInfo.super||!0!==e.$UserInfo.admin){t.next=7;break}return t.next=4,e.$Http.Post({mutation:e.$Model.Branchs,variables:{perPage:0},fields:[{data:["id","name"]}]}).then((function(e){return e.data}));case 4:a=t.sent,t.next=11;break;case 7:if(!0!==e.$UserInfo.tyeAdmin){t.next=11;break}return t.next=10,e.handleBranchTypeList();case 10:a=t.sent;case 11:e.formTemp.data=a.data;case 12:case"end":return t.stop()}}),t)})))()},handleFilterChange:function(e){this.$emit("input",e),!d["a"].isEmpty(this.callback)&&d["a"].isFunction(this.callback)&&this.callback(e)}}},s=l,c=a("c701"),u=Object(c["a"])(s,r,o,!1,null,"3f3d2be0",null);t["a"]=u.exports},ab1e:function(e,t,a){"use strict";a("f586")},f586:function(e,t,a){}}]);