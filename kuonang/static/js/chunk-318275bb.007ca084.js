(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-318275bb"],{1239:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"PurchaseOrder-list-page"},[a("div",{staticClass:"wrapper"},[a("div",{staticClass:"controller"},[a("Row",{staticClass:"filter-group",class:{active:t.rowToggle},attrs:{type:"flex",gutter:20}},[a("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[a("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[a("Col",{staticClass:"child-title",attrs:{span:"8"}},[a("span",[t._v(t._s(t.$t("dt.form.OrderNo"))+"：")])]),a("Col",{attrs:{span:"16"}},[a("Input",{attrs:{search:"",placeholder:t.$t("dt.base.pleaseInput",{label:t.$t("dt.form.OrderNo")})},on:{"on-enter":t.handleFilterChange,"on-search":t.handleFilterChange},model:{value:t.filters.orderNo_like,callback:function(e){t.$set(t.filters,"orderNo_like",e)},expression:"filters.orderNo_like"}})],1)],1)],1),a("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[a("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[a("Col",{staticClass:"child-title",attrs:{span:"8"}},[a("span",[t._v(t._s(t.$t("dt.form.PurchaseOrderName"))+"：")])]),a("Col",{attrs:{span:"16"}},[a("Input",{attrs:{search:"",placeholder:t.$t("dt.base.pleaseInput",{label:t.$t("dt.form.PurchaseOrderName")})},on:{"on-enter":t.handleFilterChange,"on-search":t.handleFilterChange},model:{value:t.filters.name_like,callback:function(e){t.$set(t.filters,"name_like",e)},expression:"filters.name_like"}})],1)],1)],1),t.$isHasMenuAuth("admin.SupplyList")?a("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[a("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[a("Col",{staticClass:"child-title",attrs:{span:"8"}},[a("span",[t._v(t._s(t.$t("dt.form.Supply"))+"：")])]),a("Col",{attrs:{span:"16"}},[a("ListSelectModal",{ref:"supply",attrs:{title:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.form.Supply")}),type:2,route:"SupplyAdd",api:t.$Model.Supplys,column:[{name:t.$t("dt.form.SupplyName")},{code:t.$t("dt.form.SupplyCode")},{telPhone:t.$t("dt.base.telPhone")},{remark:t.$t("dt.base.remark")}],attrs:{label:"name",value:"id"},filter:t.filter.supply,callback:t.handleFilterChange,placeholder:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.form.Supply")})},model:{value:t.filters.supplyId,callback:function(e){t.$set(t.filters,"supplyId",e)},expression:"filters.supplyId"}},[a("div",{staticClass:"filter-item",attrs:{slot:"filter"},slot:"filter"},[a("span",[t._v(t._s(t.$t("dt.form.SupplyCode"))+"：")]),a("Input",{attrs:{search:"","enter-button":"",placeholder:t.$t("dt.base.pleaseInput",{label:t.$t("dt.form.SupplyCode")})},on:{"on-enter":t.handleFilterSupplyCodeChange,"on-search":t.handleFilterSupplyCodeChange},model:{value:t.filter.supply.code_like,callback:function(e){t.$set(t.filter.supply,"code_like",e)},expression:"filter.supply.code_like"}})],1)])],1)],1)],1):t._e(),t.$isHasMenuAuth("admin.PurchaseOrderTypeList")?a("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[a("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[a("Col",{staticClass:"child-title",attrs:{span:"8"}},[a("span",[t._v(t._s(t.$t("dt.form.PurchaseOrderType"))+"：")])]),a("Col",{attrs:{span:"16"}},[a("Select",{attrs:{clearable:"",placeholder:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.form.PurchaseOrderType")})},on:{"on-change":t.handleFilterChange},model:{value:t.filters.tyeId,callback:function(e){t.$set(t.filters,"tyeId",e)},expression:"filters.tyeId"}},t._l(t.formTemp.PurchaseOrderTypeList,(function(e,r){return a("Option",{key:r,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1)],1)],1):t._e(),a("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[a("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[a("Col",{staticClass:"child-title",attrs:{span:"8"}},[a("span",[t._v(t._s(t.$t("dt.form.PurchaseStatus"))+"：")])]),a("Col",{attrs:{span:"16"}},[a("Select",{attrs:{clearable:"",placeholder:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.form.PurchaseStatus")})},on:{"on-change":t.handleFilterChange},model:{value:t.filters.status,callback:function(e){t.$set(t.filters,"status",e)},expression:"filters.status"}},t._l(t.$options.filters.putPurchaseType([]),(function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(" "+t._s(e.label)+" ")])})),1)],1)],1)],1),a("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[a("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[a("Col",{staticClass:"child-title",attrs:{span:"8"}},[a("span",[t._v(t._s(t.$t("dt.form.OrderTime"))+"：")])]),a("Col",{attrs:{span:"16"}},[a("date-sort",{attrs:{attr:["createdAt_gte","createdAt_lte"],placeholder:t.$t("dt.base.pleaseSelect",{label:t.$t("dt.form.StartAndEndTime")})},on:{DatePickerChange:t.handleFilterChange}})],1)],1)],1),a("Col",{staticClass:"filter-item",attrs:{xs:24,sm:12,md:8,lg:8,xl:6,xxl:6}},[a("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[a("Col",{staticClass:"child-title",attrs:{span:"8"}},[a("span",[t._v(t._s(t.$t("dt.base.sort"))+"：")])]),a("Col",{attrs:{span:"16"}},[a("sorts",{on:{swtichSorts:t.handleFilterChange}})],1)],1)],1),a("button",{staticClass:"row-toggle",attrs:{type:"button"},on:{click:function(e){return t.$store.commit("spinShow/rowToggle")}}},[t.rowToggle?a("Icon",{attrs:{type:"ios-arrow-up",size:"25",color:"#999"}}):a("Icon",{attrs:{type:"ios-arrow-down",size:"25",color:"#999"}})],1)],1),a("div",{staticClass:"btn-group"},[a("div",{staticClass:"left"},[t.$isHasMenuAuth("admin.PurchaseOrderAdd")?a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleCheckHabitType({name:"admin.PurchaseOrderAdd"})}}},[a("Icon",{attrs:{type:"md-add"}}),t._v(t._s(t.$t("dt.form.PurchaseOrderAdd"))+" ")],1):t._e(),t.$isHasMenuAuth("admin.PurchaseOrderDelete")?a("Button",{attrs:{type:"error"},on:{click:function(e){return t.handleAsync(t.tableMultipleSelect)}}},[a("Icon",{attrs:{type:"md-trash"}}),t._v(t._s(t.$t("dt.form.deleteAll"))+" ")],1):t._e(),t.$isHasMenuAuth("admin.PurchaseOrderEdit")?a("Button",{attrs:{type:"success"},on:{click:function(e){return t.handleAsyncSavaAll(t.tableMultipleSelect)}}},[a("Icon",{attrs:{type:"md-create"}}),t._v(t._s(t.$t("dt.form.saveAll"))+" ")],1):t._e()],1),a("div",{staticClass:"right"},[t.$isHasMenuAuth("admin.PurchaseOrderExport")?a("Button",{attrs:{type:"warning"},on:{click:t.handleAsyncExport}},[a("Icon",{attrs:{type:"md-cloud-download"}}),t._v(t._s(t.$t("dt.form.export"))+"Excel ")],1):t._e()],1)]),a("div",{staticClass:"table"},[a("Table",{ref:"selection",attrs:{border:"",loading:t.loading&&t.isMethodList,columns:t.columns,data:t.formTemp.data},on:{"on-select-cancel":t.handleTableOnSelectCancel,"on-selection-change":t.handleTableSelectionChange}})],1),a("div",{staticClass:"page-list"},[a("Page",{attrs:{"show-total":"","show-sizer":"","show-elevator":"",total:t.formTemp.total,current:t.formTemp.current_page,"page-size-opts":t.formTemp.pageSizeOpts,"page-size":t.formTemp.per_page},on:{"on-page-size-change":t.handleOnPageSizeChange,"on-change":t.handleChangePage}})],1)],1)]),a("Drawer",{attrs:{title:t.$t("dt.form.RevokeProductDetail"),width:"480",closable:!1,scrollable:!0,draggable:!0},model:{value:t.formTemp.drawer,callback:function(e){t.$set(t.formTemp,"drawer",e)},expression:"formTemp.drawer"}},[a("Row",[a("Col",{attrs:{span:"12"}},[t._v(t._s(t.$t("dt.form.ParentWarehouse"))+"：123")])],1)],1),a("Modal",{attrs:{"class-name":"settlement-layer",transfer:!0,"footer-hide":!0,"mask-closable":!1},model:{value:t.settlement,callback:function(e){t.settlement=e},expression:"settlement"}},[a("table",[a("thead",[a("tr",[a("th",[t._v(t._s(t.$t("dt.form.OrderNo")))]),a("th",[t._v(t._s(t.$t("dt.form.PurchaseMoney")))]),a("th",[t._v(t._s(t.$t("dt.form.PaidMoney")))]),a("th",[a("span",[t._v(t._s(t.$t("dt.form.SurplusMoney")))]),a("span",{staticStyle:{color:"#2d8cf0","margin-left":"5px",cursor:"pointer"},on:{click:function(e){return t.handleSettleAll()}}},[t._v(" "+t._s(t.$t("dt.base.All"))+" ")])])])]),a("tbody",[a("tr",[a("td",[t._v(t._s(t.formTemp.currentSettlement.orderNo))]),a("td",[t._v("¥"+t._s(t._f("money")(t.formTemp.currentSettlement.money)))]),a("td",[t._v("¥"+t._s(t._f("money")(t.formTemp.currentSettlement.payMoney)))]),a("td",[t._v("¥"+t._s(t._f("money")(t.formTemp.currentSettlement.surplusMoney)))])]),a("tr",[a("td",{attrs:{align:"right",colspan:"4"}},[a("div",{staticClass:"content"},[a("RadioGroup",{model:{value:t.formTemp.currentSettlement.settle,callback:function(e){t.$set(t.formTemp.currentSettlement,"settle",e)},expression:"formTemp.currentSettlement.settle"}},t._l(t.$options.filters.settleType([]),(function(e){return a("Radio",{key:e.value,attrs:{disabled:1===e.value&&100*t.settlementMoney>=t.formTemp.currentSettlement.surplusMoney,label:e.value}},[t._v(" "+t._s(e.label)+" ")])})),1),a("div",{staticClass:"body"},[a("span",[t._v(t._s(t.$t("dt.base.Money"))+"：")]),a("Input",{attrs:{size:"small",placeholder:t.$t("dt.base.pleaseInput",{label:t.$t("dt.base.Money")})},model:{value:t.settlementMoney,callback:function(e){t.settlementMoney=e},expression:"settlementMoney"}}),a("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.handleSettlement()}}},[t._v(t._s(t.$t("dt.base.confirm")))])],1)],1)])])])])])],1)},s=[],n=(a("2d38"),a("2c78"),a("9953"),a("69bf"),a("02bf"),a("a39b"),a("5c4c"),a("d211")),l=a("b8f9"),i=a("efa4"),o=a("494e"),d={name:"PurchaseOrderList",mixins:[i["a"]],data:function(){return{filter:{supply:{}},settlement:!1,settlementMoney:0,formTemp:{drawer:!1,currentItem:[],currentSettlement:{settle:1},warehouseList:[],supplyList:[],PurchaseOrderTypeList:[]}}},components:{ListSelectModal:o["a"]},computed:{columns:function(){var t=this;return[{type:"selection",width:60,align:"center",fixed:"left"},{title:this.$t("dt.form.index"),type:"index",width:80,align:"center"},{title:this.$t("dt.form.OrderNo"),key:"orderNo",width:160,align:"center",render:function(e,a){return e(t.$isHasMenuAuth("admin.PurchaseOrderDetail")?"router-link":"span",{props:{to:{name:"admin.PurchaseOrderDetail",params:{id:a.row.id}}}},a.row.orderNo)}},{title:this.$t("dt.form.PurchaseOrderName"),key:"name",minWidth:200,align:"center"},{title:this.$t("dt.form.PurchaseProject"),width:100,align:"center",render:function(e,a){var r=a.row.detailIds||[];return e("span","".concat(r.length," ").concat(t.$t("dt.base.term")))}},{title:this.$t("dt.form.PurchaseNumber"),key:"number",width:100,align:"center",render:function(e,a){var r=a.row.number||0;return e("span","".concat(r," ").concat(t.$t("dt.base.piece")))}},{title:this.$t("dt.form.PurchaseMoney"),key:"money",width:120,align:"center",render:function(e,a){var r=a.row.money||0;return e("span","".concat(t.$options.filters.money(r)," ").concat(t.$t("dt.base.unit")))}},{title:this.$t("dt.form.PaidMoney"),width:120,align:"center",render:function(e,a){var r=a.row.financeLog||[],s=r.filter((function(t){return 2===t.status})).map((function(t){return t.money})).reduce((function(t,e){return t+e}),0);return e("span","".concat(t.$options.filters.money(s)," ").concat(t.$t("dt.base.unit")))}},{title:this.$t("dt.form.PutNumber"),key:"putNumber",width:100,align:"center",render:function(e,a){var r=a.row.putNumber||0;return e("span","".concat(r," ").concat(t.$t("dt.base.piece")))}},{title:this.$t("dt.form.RevokeProductNumber"),key:"revokeNumber",width:100,align:"center",render:function(e,a){var r=a.row.revokeNumber||0;return r<=0?e("span","".concat(r," ").concat(t.$t("dt.base.piece"))):e("span",{style:{color:"#2d8cf0",cursor:"pointer"},on:{}},"".concat(r," ").concat(t.$t("dt.base.piece")))}},{title:this.$t("dt.form.PurchaseOrderType"),width:150,align:"center",render:function(t,e){var a=e.row.tye||{};return t("span",a.name)}},{title:this.$t("dt.form.Supply"),minWidth:200,align:"center",render:function(t,e){var a=e.row.supply||{};return t("span",a.name)}},{title:this.$t("dt.base.telPhone"),minWidth:200,align:"center",render:function(t,e){var a=e.row.supply||{};return t("span",a.telPhone)}},{title:this.$t("dt.form.PurchaseStartTime"),key:"startTime",width:170,align:"center",sortable:!0,render:function(e,a){return e("span",t.$options.filters.formatTime(a.row.startTime,"YYYY-MM-DD"))}},{title:this.$t("dt.form.PurchaseEndTime"),key:"endTime",width:170,align:"center",sortable:!0,render:function(e,a){return e("span",t.$options.filters.formatTime(a.row.endTime,"YYYY-MM-DD"))}},{title:this.$t("dt.base.remark"),key:"remark",minWidth:200,maxWidth:300,tooltip:!0,align:"center"},{title:this.$t("dt.form.createdAt"),key:"createdAt",width:170,align:"center",sortable:!0,render:function(e,a){return e("span",t.$options.filters.formatTime(a.row.createdAt))}},{title:this.$t("dt.form.PurchaseStatus"),key:"status",width:120,align:"center",fixed:"right",render:function(e,a){var r=a.row.status,s="#2d8cf0";return 2===r?s="#ff9900":3===r?s="#19be6b":4===r?s="#c5c8ce":5===r&&(s="#ed4014"),t.$isHasMenuAuth("admin.PurchaseOrderEdit")&&-1!==t.selectTable.indexOf(a.row.id)?e("div",[e("e-select",{props:{current:r,name:"label",value:"value",dataList:t.$options.filters.putPurchaseType([])},on:{handleSelectChange:function(e){return t.handleSelectChange(e,a.index,a.column.key)}}})]):e("span",{style:{color:s}},t.$options.filters.putPurchaseType(r))}},{title:this.$t("dt.form.action"),key:"action",width:120,align:"center",fixed:"right",render:function(e,a){if(t.$isHasMenuAuth("admin.PurchaseOrderEdit")&&-1!==t.selectTable.indexOf(a.row.id))return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.handleAsyncSavaAll(a.row)}}},t.$t("dt.form.save")),e("Button",{props:{type:"warning",size:"small"},on:{click:function(){t.handleTableRowCancelChecked(a.row)}}},t.$t("dt.form.cancel"))]);var r=[];return t.$isHasMenuAuth("admin.PurchaseOrderDetail")&&-1!==[3,4].indexOf(a.row.status)&&r.push(e("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){t.handleCheckHabitType({name:"admin.PurchaseOrderDetail",params:{id:a.row.id}})}}},t.$t("dt.form.detail"))),t.$isHasMenuAuth("admin.PurchaseOrderEdit")&&1===a.row.status&&r.push(e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.$Modal.confirm({title:t.$t("dt.toast.tips"),content:"".concat(t.$t("dt.base.whether")).concat(t.$t("dt.form.PutPurchase"),"?"),loading:!0,closable:!0,onOk:function(){t.handlePutPurchase(a.row,2)}})}}},t.$t("dt.form.Start"))),t.$isHasMenuAuth("admin.PurchaseOrderEdit")&&2===a.row.status&&r.push(e("Button",{props:{type:"success",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.$Modal.confirm({title:t.$t("dt.toast.tips"),content:"".concat(t.$t("dt.base.whether")).concat(t.$t("dt.form.PurchaseComplete"),"?"),loading:!0,closable:!0,onOk:function(){t.handlePutPurchase(a.row,3)}})}}},t.$t("dt.form.Complete"))),t.$isHasMenuAuth("admin.PurchaseOrderEdit")&&1===a.row.status&&r.push(e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.handleCheckHabitType({name:"admin.PurchaseOrderEdit",params:{id:a.row.id}})}}},t.$t("dt.form.edit"))),t.$isHasMenuAuth("admin.PurchaseOrderEdit")&&-1!==[1,2].indexOf(a.row.status)&&r.push(e("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){t.$Modal.confirm({title:t.$t("dt.toast.tips"),content:"".concat(t.$t("dt.base.whether")).concat(t.$t("dt.form.PurchaseStop"),"?"),loading:!0,closable:!0,onOk:function(){t.handlePutPurchase(a.row,4)}})}}},t.$t("dt.form.End"))),e("div",r)}}]}},created:function(){this.handlePurchaseOrderTypeList(),this.handleList()},mounted:function(){},watch:{},filters:{},methods:{handleList:function(){var t=this,e=this.handleInitFields(this.columns,["isPay","productIds","detailIds","tye.id","tye.name","supply.id","supply.name","supply.telPhone","user.id","user.username","user.phone","financeLog.id","financeLog.money","financeLog.status"]),a=this.variables;this.$Http.Post({mutation:this.$Model.PurchaseOrders,variables:a,fields:e}).then((function(e){var a=e.data;t.formTemp=Object(n["a"])(Object(n["a"])({},t.formTemp),a),t.sortData(t.formTemp.data)}))},sortData:function(){var t=this;l["a"].each(this.formTemp.data,(function(e,a){e.settle=1,e.surplusMoney=e.money-e.payMoney,e.index=(t.formTemp.current_page-1)*t.formTemp.per_page+a+1,e.loading=!1}))},handlePurchaseOrderTypeList:function(){var t=this;this.$isHasMenuAuth("admin.PurchaseOrderTypeList")&&this.$Http.Post({mutation:this.$Model.PurchaseOrderTypes,variables:{perPage:0},fields:[{data:["id","name"]}]}).then((function(e){var a=e.data;t.formTemp.PurchaseOrderTypeList=a.data}))},handleSettleAll:function(){this.settlementMoney=this.$options.filters.money(this.formTemp.currentSettlement.surplusMoney),this.formTemp.currentSettlement.settle=2},handleSettlement:function(){var t=this,e=this.formTemp.currentSettlement,a=1*this.$options.filters.formatMoney(100*this.settlementMoney);if(this.$rules.money(a)){var r={id:e.id,isPay:2===e.settle?3:2,payMoney:e.payMoney+a};this.handleRowItemSave(r,(function(s){if(!l["a"].isEmpty(s)){var n=t.formTemp.data.findIndex((function(t){return t.id===e.id}));-1!==n&&(t.formTemp.data[n].isPay=r.isPay,t.formTemp.data[n].payMoney=r.payMoney,t.formTemp.data[n].surplusMoney-=a,t.formTemp.data[n].surplusMoney<0&&(t.formTemp.data[n].surplusMoney=0)),t.settlement=!1,t.$Message.success("".concat(t.$t("dt.form.action")).concat(t.$t("dt.status.success"))),t.$Modal.remove()}}))}else this.$Notice.warning({title:this.$t("dt.toast.tips"),desc:this.$t("dt.toast.PleaseEnterTheCorrectAmount")})},handlePutPurchase:function(t,e){var a=this,r=Object(n["a"])({},t);r.status=e||2,this.handleRowItemSave(r,(function(e){l["a"].isEmpty(e)||(t.status=r.status,a.$Modal.remove())}))},handleFilterSupplyCodeChange:function(){this.filter.supply.code_like||delete this.filter.supply.code_like,this.$refs.supply.handleSlotWatch()},handleRowItemSave:function(t,e){l["a"].isEmpty(t)||this.handleOnRecovery({api:this.$Model.PurchaseOrderEdit,item:t,type:2},e)},handleUpdateStatus:function(t,e){this.handleUpdateStatusFunc({api:this.$Model.PurchaseOrderEdit,item:t,value:e})},handleRecovery:function(t,e){l["a"].isEmpty(t)||this.handleOnRecovery({api:this.$Model.PurchaseOrdersRecovery,item:t},e)},handleDelete:function(t){l["a"].isEmpty(t.id)||l["a"].isEmpty(t.index)||this.handleOnDelete({api:this.$Model.PurchaseOrdersDelete,item:t})}}},c=d,u=(a("a4b7"),a("c701")),p=Object(u["a"])(c,r,s,!1,null,"dfd13608",null);e["default"]=p.exports},a4b7:function(t,e,a){"use strict";a("fd44c")},fd44c:function(t,e,a){}}]);