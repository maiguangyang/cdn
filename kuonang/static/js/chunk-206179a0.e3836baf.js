(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-206179a0"],{"494e":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"key-value"},[a("div",{staticClass:"input"},["[object Object]"!==Object.prototype.toString.call(t.value)&&2===t.type?a("div",{staticClass:"select-list",staticStyle:{width:"100%",margin:"0"}},[a("Input",{attrs:{icon:"ios-arrow-down",readonly:t.readonly,clearable:t.clearable,placeholder:t.placeholder},on:{"on-focus":function(e){return t.handleOpenSwitch()},"on-clear":t.handleClearCurrent},model:{value:t.current[t.attrs.label],callback:function(e){t.$set(t.current,t.attrs.label,e)},expression:"current[attrs.label]"}})],1):a("div",{staticClass:"select-list",class:t.readonly?"":"no-readonly"},[t.showList?a("div",t._l(t.tableMultipleSelect,(function(e){return a("div",{key:e.id,staticClass:"item",on:{click:function(a){return t.handleRemoveItem(e)}}},[a("span",[t._v(t._s(e[t.attrs.label]))]),a("Icon",{attrs:{size:"20",type:"ios-trash-outline"}})],1)})),0):t._e(),t.readonly?t._e():a("div",{staticClass:"icon",on:{click:function(e){return t.handleOpenSwitch()}}},[a("Tooltip",{attrs:{disabled:!t.tooltip.content,content:t.tooltip.content,"max-width":t.tooltip.maxWidth,placement:t.tooltip.placement}},[a("Icon",{attrs:{size:"25",color:"#fff",type:"md-add"}})],1)],1)])]),a("Modal",{attrs:{width:t.modelWidth,"mask-closable":!1,"class-name":"modal-layer"},on:{"on-visible-change":t.handleOnVisibleChange},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[a("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[a("h2",[t._v(t._s(t.title))]),a("span",[t._v("("+t._s("[object Array]"!==Object.prototype.toString.call(t.value)?t.$t("dt.base.SingleSelect"):t.$t("dt.base.MultipleSelect"))+")")])]),a("div",{staticClass:"connent-layer"},[a("div",{staticClass:"nav-group"},[a("div",{staticClass:"filter-layer"},[a("div",{staticClass:"filter-item",staticStyle:{"max-width":"300px"}},[a("span",[t._v(t._s(t.formTemp.filters.title)+"ï¼š")]),a("Input",{staticClass:"search-input",attrs:{search:"","enter-button":"Search",placeholder:t.$t("dt.base.pleaseInput",{label:t.formTemp.filters.title})},on:{"on-search":t.handleFilterChange,"on-enter":t.handleFilterChange},model:{value:t.filters[t.formTemp.filters.key],callback:function(e){t.$set(t.filters,t.formTemp.filters.key,e)},expression:"filters[formTemp.filters.key]"}})],1),t._t("filter")],2),a("div",{staticClass:"add-layer"},[a("span",{attrs:{type:"text"},on:{click:function(e){return t.handleRefresh()}}},[t._v(t._s(t.$t("dt.base.Refresh")))]),t.$isHasMenuAuth("admin."+t.route)?a("Button",{on:{click:function(e){return t.handleAdd({name:"admin."+t.route})}}},[t._v(" "+t._s(t.$t("dt.form.add"))+" ")]):t._e()],1)]),a("div",{staticClass:"product-layer"},[t._t("left"),a("div",{staticClass:"table-layout"},[a("Table",{ref:"selection",attrs:{border:"",loading:t.loading&&t.isMethodList,"highlight-row":!0,columns:t.coldata,data:t.formTemp.data},on:{"on-select-cancel":t.handleTableOnSelectCancel,"on-selection-change":t.handleTableSelectionChange}})],1)],2)]),a("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"left"},[a("div",{staticClass:"page-list"},[a("Page",{attrs:{"show-total":"","show-sizer":"","show-elevator":"",total:t.formTemp.total,current:t.formTemp.current_page,"page-size-opts":t.formTemp.pageSizeOpts,"page-size":t.formTemp.per_page},on:{"on-page-size-change":t.handleOnPageSizeChange,"on-change":t.handleChangePage}})],1)]),a("div",{staticClass:"right"},[a("Button",{on:{click:t.handleCancel}},[t._v(t._s(t.$t("dt.form.cancel")))]),t.formTemp.data.length>0?a("Button",{attrs:{type:"primary"},on:{click:t.handleConfirm}},[t._v(t._s(t.$t("dt.base.confirm")))]):t._e()],1)])])],1)},l=[],n=(a("2d38"),a("2c78"),a("1b8a"),a("9953"),a("69bf"),a("64fe"),a("02bf"),a("a39b"),a("90d4"),a("5c4c"),a("4798"),a("b8a1"),a("0c65"),a("d211")),s=a("4c09"),r=a("b8f9"),o=a("efa4"),c={name:"KeyValue",mixins:[o["a"]],data:function(){return{open:!1,confirm:!1,modelWidth:850,watchFilter:{},aloneArr:[],current:{},formData:{},formTemp:{data:[],tableData:[],oldData:[],filters:{},pageSizeOpts:[10,20,30,40,50,100,1e3,1e4,1e5]},coldata:[],oldTableMultipleSelect:[]}},props:{showList:{type:Boolean,default:!0},title:{type:String,default:""},placeholder:{type:String,default:""},type:{type:Number,default:1},route:{type:String,default:""},api:{type:Object,default:function(){return{}}},column:{type:Array,default:function(){return[]}},merge:{type:Array,default:function(){return[]}},clearable:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},list:{type:Boolean,default:!1},tooltip:{type:Object,default:function(){return{}}},attrs:{type:Object,default:function(){return{label:"label",value:"id"}}},filter:{type:Object,default:function(){return{}}},value:null,callback:null},computed:{loadData:function(){return this.$store.state.popupModel.loadData}},created:function(){},mounted:function(){window.qq=this,this.watchFilter=this.filter,r["a"].isEmpty(this.oldTableMultipleSelect)&&(this.oldTableMultipleSelect=JSON.parse(JSON.stringify(Object(s["a"])(this.tableMultipleSelect)))),this.value&&this.handleColumnsChange()},destroyed:function(){this.formData={},this.formTemp={data:[],current_page:1,per_page:10,total:0,total_page:0,pageSizeOpts:[10,20,30,40,50,100,1e3,1e4,1e5]},this.$store.commit("base/selectTable",{selectTable:[]})},watch:{open:function(t){!0===t&&(this.confirm=!1,this.handleColumnsChange())},value:function(t,e){r["a"].isEmpty(t)&&(this.current={},this.tableMultipleSelect=[],this.oldTableMultipleSelect=[]),t&&t!==e&&(this.formTemp.data=this.formTemp.oldData,this.handleColumnsChange())}},methods:{handleList:function(){var t=this;if(r["a"].isEmpty(this.api))this.$Notice.error({title:this.$t("dt.toast.tips"),desc:this.$t("dt.toast.apiIsEmpty")});else{-1===this.aloneArr.indexOf("weight")&&this.aloneArr.push("weight");var e=this.handleInitFields(this.coldata,this.aloneArr.concat(this.merge)),a=Object(n["a"])(Object(n["a"])({},this.variables.filter),this.watchFilter);this.$Http.Post({mutation:this.api,variables:Object(n["a"])(Object(n["a"])({},this.variables),{},{filter:a}),fields:e}).then((function(e){var a=e.data;r["a"].each(a.data,(function(t){t._disabled=!1})),t.formTemp=Object(n["a"])(Object(n["a"])({},t.formTemp),a),t.handleMultipleSelect()}))}},sortData:function(){var t=this;r["a"].each(this.formTemp.data,(function(e,a){e.index=(t.formTemp.current_page-1)*t.formTemp.per_page+a+1,e.loading=!1}))},handleClearCurrent:function(){this.formTemp.data=[],this.formTemp.tableData=[],this.tableMultipleSelect=[],this.handleColumnsChange(),this.handleConfirm()},handleOpenSwitch:function(){this.readonly||(this.open=!0)},handleRefresh:function(){var t=this;this.$apollo.getClient().cache.reset(),setTimeout((function(){t.handleList()}),300)},handleMultipleSelect:function(){var t=this;if(r["a"].isEmpty(this.value))this.tableMultipleSelect=[];else{this.sortData();var e=this.tableMultipleSelect;r["a"].isArray(this.value)?r["a"].each(this.formTemp.data,(function(a,i){var l=t.value.indexOf(a[t.attrs.value]);-1!==l?-1===e.findIndex((function(t){return t.id===a.id}))&&e.push(a):t.$set(t.formTemp.data,i,Object(n["a"])(Object(n["a"])({},t.formTemp.data[i]),{},{_checked:!1}))})):r["a"].each(this.formTemp.data,(function(a,i){a[t.attrs.value]===t.value?(t.current=a,-1===e.findIndex((function(t){return t.id===a.id}))&&e.push(a)):t.$set(t.formTemp.data,i,Object(n["a"])(Object(n["a"])({},t.formTemp.data[i]),{},{_checked:!1}))})),this.tableMultipleSelect=r["a"].uniqBy(e,this.attrs.value),this.oldTableMultipleSelect=JSON.parse(JSON.stringify(Object(s["a"])(this.tableMultipleSelect))),this.$store.commit("popupModel/loadData",{loadData:!1})}},handleColumnsChange:function(){var t=this,e=[{type:"selection",width:60,align:"center"},{title:this.$t("dt.form.index"),type:"index",width:80,align:"center"}];r["a"].each(this.column,(function(a){if(!r["a"].isEmpty(a)&&r["a"].isObject(a)){var i=Object.keys(a),l=Object.values(a);if(r["a"].isObject(l[0])){var n=Object.keys(l[0]).pop(),s={align:"center",title:Object.values(l[0]).pop(),minWidth:120,render:function(t,e){var l=e.row[i[0]];if(a.filters&&r["a"].isFunction(a.filters)){if(r["a"].isArray(l)){var s=l.map((function(t){return t[n]})).reduce((function(t,e){return t+e}),0);return s=a.filters(s),t("span",s)}return t("span",l[n])}return r["a"].isArray(l)?t("span",l.map((function(t){return t[n]})).join()):t("span",l[n])}},o=i.indexOf("width");-1!==o&&(s.width=l[o]),t.aloneArr.push("".concat(i[0],".id")),t.aloneArr.push("".concat(i[0],".").concat(n)),e.push(s)}else{var c={align:"center",title:l[0],key:i[0],minWidth:120},d=i.indexOf("filters");-1!==d&&(c.render=function(e,a){if(r["a"].isFunction(l[d]))return e("span",t.$options.filters[l[d]](a.row[i[0]]));if(r["a"].isObject(l[d])){var n=t.$options.filters[l[d].name](a.row[i[0]],l[d].value),s=t.formTemp.data.findIndex((function(t){return t.id===a.row.id}));return-1!==s&&(t.formTemp.data[s]._disabled=!n||!1),e("span",t.$options.filters.formatInJobTime(n))}return e("span",t.$options.filters[l[d]](a.row[i[0]]))});var h=i.indexOf("width");-1!==h&&(c.width=l[h]),r["a"].isEmpty(t.formTemp.filters)&&(t.formTemp.filters={title:l[0],key:"".concat(i[0],"_like")}),e.push(c)}}})),this.coldata=e,this.handleList()},handleOnVisibleChange:function(t){!1===t&&!1===this.confirm&&this.handleCancel()},handleTableRowCancelChecked:function(t){if(!r["a"].isEmpty(t)){var e=this.formTemp.data.findIndex((function(e){return e.id===t.id}));-1!==e&&this.$set(this.formTemp.data,e,Object(n["a"])(Object(n["a"])({},this.formTemp.data[e]),{},{_checked:!1}));var a=this.formTemp.data.filter((function(t){return!0===t._checked})),i=a.map((function(t){return t.id}));this.tableMultipleSelect=a,this.$store.commit("base/selectTable",{selectTable:i})}},handleTableSelectionChange:function(t){var e=this;r["a"].isArray(this.value)&&r["a"].each(this.value,(function(a){var i=e.formTemp.data.find((function(t){return t.id===a}));r["a"].isEmpty(i)||-1!==t.findIndex((function(t){return t.id===a}))||t.push(i)})),r["a"].isObject(this.value)||2!==this.type||(this.current=r["a"].isEmpty(t)?{}:t[0]),!r["a"].isArray(this.value)&&t.length>0&&(t=[t[0]]),this.tableMultipleSelect=t,this.$store.commit("base/selectTable",{selectTable:[]});var a=[];r["a"].each(this.formTemp.data,(function(i,l){i._checked=!1,i._disabled=!1;var s=t.findIndex((function(t){return t.id===i.id}));-1!==s?(i._checked=!0,a.push(i.id)):e.$set(e.formTemp.data,l,Object(n["a"])(Object(n["a"])({},e.formTemp.data[l]),{},{_checked:!1,_disabled:!r["a"].isArray(e.value)&&e.tableMultipleSelect.length>0}))})),this.$store.commit("base/selectTable",{selectTable:a})},handleRemoveItem:function(t){if(!this.readonly){var e=this.tableMultipleSelect.findIndex((function(e){return e.id===t.id}));if(-1!==e){this.tableMultipleSelect.splice(e,1);var a=this.formTemp.data.findIndex((function(e){return e.id===t.id}));-1!==a&&(this.$set(this.formTemp.data,a,Object(n["a"])(Object(n["a"])({},this.formTemp.data[a]),{},{_checked:!1})),this.formTemp.data[a]._checked=!1)}this.handleRemoveMultipleSelect(),this.handleConfirm()}},handleRemoveMultipleSelect:function(){var t=this;r["a"].isEmpty(this.tableMultipleSelect)&&r["a"].each(this.formTemp.data,(function(e,a){t.$set(t.formTemp.data,a,Object(n["a"])(Object(n["a"])({},t.formTemp.data[a]),{},{_checked:!1,_disabled:!1}))}))},handleConfirm:function(){var t=this;this.oldTableMultipleSelect=JSON.parse(JSON.stringify(Object(s["a"])(this.tableMultipleSelect)));var e=r["a"].uniqBy(this.tableMultipleSelect.map((function(e){return e[t.attrs.value]}))),a=e.join();if(r["a"].isArray(this.value)&&(a=r["a"].uniqBy(this.value.concat(e))),this.$emit("input",a),!r["a"].isEmpty(this.callback)&&r["a"].isFunction(this.callback)){var i=[];r["a"].isArray(a)?r["a"].each(this.formTemp.data,(function(e){var l=a.indexOf(e[t.attrs.value]);-1!==l&&i.push(e)})):i=this.formTemp.data.filter((function(e){return e[t.attrs.value]===a})),r["a"].each(i,(function(t){delete t.index,delete t.loading,delete t._checked,delete t._disabled})),this.callback(i)}this.$apollo.getClient().cache.reset(),this.open=!1,this.confirm=!0},handleCancel:function(){var t=this;this.tableMultipleSelect=JSON.parse(JSON.stringify(Object(s["a"])(this.oldTableMultipleSelect))),r["a"].isEmpty(this.tableMultipleSelect)&&this.handleRemoveMultipleSelect(),r["a"].each(this.tableMultipleSelect,(function(e,a){var i=t.tableMultipleSelect.findIndex((function(e){return e[t.attrs.value]}));-1===i&&t.$set(t.formTemp.data,a,Object(n["a"])(Object(n["a"])({},t.formTemp.data[a]),{},{_checked:!1}))})),r["a"].isEmpty(this.tableMultipleSelect)&&(this.current={}),this.open=!1,this.$store.commit("popupModel/pageModal",{pageModal:!1}),this.$store.commit("popupModel/loadData",{loadData:!1})},handleAdd:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$store.commit("popupModel/pageModal",{pageModal:!0}),this.handleCheckHabitType(t)},handleSlotWatch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e in t)t[e]||delete t[e];r["a"].isEmpty(t)&&(this.variables.filter={}),this.watchFilter=Object(n["a"])(Object(n["a"])({},this.filter),t),this.formTemp.current_page=1,this.handleList()}}},d=c,h=(a("af8f"),a("c701")),u=Object(h["a"])(d,i,l,!1,null,"38d1f1c8",null);e["a"]=u.exports},af8f:function(t,e,a){"use strict";a("ec02f")},ec02f:function(t,e,a){}}]);